<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="metaRange">
<title>01: Introduction to metaRange • metaRange</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="01: Introduction to metaRange">
<meta property="og:description" content="metaRange">
<meta property="og:image" content="https://metaRange.github.io/metaRange/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">metaRange</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item">
  <a class="nav-link" href="../articles/metaRange.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/metaRange.html">Introduction</a>
    <a class="dropdown-item" href="../articles/advanced_setup.html">Advanced setup</a>
    <a class="dropdown-item" href="../articles/species_interactions.html">Species interactions</a>
    <a class="dropdown-item" href="../articles/metabolic_scaling.html">Metabolic scaling</a>
    <a class="dropdown-item" href="../articles/directed_dispersal.html">Directed (weighted) dispersal</a>
    <a class="dropdown-item" href="../articles/age-structured-populations.html">Age structured populations</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/metaRange/metaRange/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>01: Introduction to metaRange</h1>
                        <h4 data-toc-skip class="author">Fallert, S. and
Cabral, J.S.</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/metaRange/metaRange/blob/HEAD/vignettes/metaRange.Rmd" class="external-link"><code>vignettes/metaRange.Rmd</code></a></small>
      <div class="d-none name"><code>metaRange.Rmd</code></div>
    </div>

    
    
<p>In general, <code>metaRange</code> is a framework to build a variety
of different process based species distribution models. The package is
build around an <code>simulation</code> object that manages the
simulation state. This simulation object contains an
<code>environment</code> that holds and manages all the environmental
factors that may influence the simulation (as raster data) and it can
contain one or more <code>species</code> that are simulated in the
environment. Each species has two main characteristics:
<code>traits</code> which can be (somewhat arbitrary) pieces of data
that describe the species and <code>processes</code> which are functions
that describe how the species interacts with itself, time, climate and
other species. During each time step of the simulation, the processes
are executed in a user defined order and can access and modify the
species traits.</p>
<p>While the models built with metaRange can be quite variable in their
structure, they are all based on population dynamics. This means that in
most cases a <code>trait</code> will not be a singular number but a
matrix that has the same size as the raster data in the environment,
where each value represents the trait value for one population in the
corresponding grid cell of the of the environment. Based on this, most
<code>processes</code> will describe population (and meta population)
dynamics and not individual based mechanisms. Figure 1 shows an example
of some of the different envionmental factors, species traits and
processes that could be included in a simulation.</p>
<div class="figure">
<img src="../reference/figures/example_simulation.svg" alt="Figure 1: Example of some of the different envionmental factors, species traits and processes that could be included in a simulation." width="100%"><p class="caption">
Figure 1: Example of some of the different envionmental factors, species
traits and processes that could be included in a simulation.
</p>
</div>
A more technical overview of the different components of a simulation
and how they interact with each other is shown in Figure 2. While the
environment has a temporal dimension (i.e. the different time steps, see
Fig.1), the traits (or the global variables of the simulation) have no
temporal property. They represent the state of the species (or of the
simulation respectivly) in one (the current) time step. When a process
is executed within a time step, it can access this current state of the
simulation and modify it, which results in changing traits over the
course of the simulation. Each process can be assigned a priority, that
is used by the <code>process priority queue</code> to determine in which
order the processes are executed within one time step.
<div class="figure">
<img src="../reference/figures/simulation_high_level_overview.svg" alt="Figure 2: Overview of the different components of a simulation and how they interact with each other. Note that the number of species &amp; processes per species is not limited, but only two are shown for simplicity." width="100%"><p class="caption">
Figure 2: Overview of the different components of a simulation and how
they interact with each other. Note that the number of species &amp;
processes per species is not limited, but only two are shown for
simplicity.
</p>
</div>
<div class="section level2">
<h2 id="setting-up-a-simulation">Setting up a simulation<a class="anchor" aria-label="anchor" href="#setting-up-a-simulation"></a>
</h2>
<p>Following is a simple example of how to set up a simulation with
<code>metaRange</code>. To start, we need to load the package and its
dependencies.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://metaRange.github.io/metaRange">metaRange</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; metaRange version: 0.0.0.9000</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/" class="external-link">terra</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; terra 1.7.55</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="loading-the-landscape">Loading the landscape<a class="anchor" aria-label="anchor" href="#loading-the-landscape"></a>
</h2>
<p>The first step when setting up a simulation is the loading of the
environment in which the simulation will take place. In the real world,
this data can be obtained from a variety of sources, and may include for
example different climate variables, land cover or elevation.</p>
<p>The simulations expects this data as an
<code>SpatRasterDataset</code> (<code>SDS</code>) which is a collection
of different raster files that all share the same extent and resolution.
Each sub-dataset in this SDS represents one environmental variable and
each layer represents one time step of the simulation. In other words,
metaRange doesn’t simulate the environmental conditions itself, but
expects the user to provide the environmental data for each time
step.</p>
<p>To create such an dataset one can use the function
<code><a href="https://rdrr.io/pkg/terra/man/sds.html" class="external-link">terra::sds()</a></code>. One important note: Since the layer represent
the condition in one time step, all the raster files that go into the
<code>SDS</code> need to have the same number of layer (i.e. the desired
number of time steps the simulation should have). After the
<code>SDS</code> is created, the individual subdatasets should be named,
since this is how the simulation will refer to them.</p>
<p>To simplify this introduction, we use a randomly generated landscape
consisting of temperature, precipitation and habitat quality data, with
10 time steps (layer) that are all the same (i.e. no environmental
change). If you are interested, you can find the code to generate this
landscape at the end of this vignette, but otherwise it’s enough to know
that throughout this tutorial <code>create_example_landscape()</code>
does create such a landscape.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">landscape</span> <span class="op">&lt;-</span> <span class="fu">create_example_landscape</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">landscape</span></span>
<span><span class="co">#&gt; class       : SpatRasterDataset </span></span>
<span><span class="co">#&gt; subdatasets : 3 </span></span>
<span><span class="co">#&gt; dimensions  : 100, 100 (nrow, ncol)</span></span>
<span><span class="co">#&gt; nlyr        : 10, 10, 10 </span></span>
<span><span class="co">#&gt; resolution  : 1, 1  (x, y)</span></span>
<span><span class="co">#&gt; extent      : 0, 100, 0, 100  (xmin, xmax, ymin, ymax)</span></span>
<span><span class="co">#&gt; coord. ref. :  </span></span>
<span><span class="co">#&gt; source(s)   : memory </span></span>
<span><span class="co">#&gt; names       : temperature, precipitation, habitat</span></span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span></span>
<span>    <span class="va">landscape</span><span class="op">$</span><span class="va">temperature</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>,</span>
<span>    col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html" class="external-link">hcl.colors</a></span><span class="op">(</span><span class="fl">100</span>, <span class="st">"Geyser"</span><span class="op">)</span>,</span>
<span>    main <span class="op">=</span> <span class="st">"Temperature [K]"</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="metaRange_files/figure-html/landscape_01-1.png" alt="Figure 3: The temperature of the example landscape. Only the first layer of 10 identical ones is shown." width="700"><p class="caption">
Figure 3: The temperature of the example landscape. Only the first layer
of 10 identical ones is shown.
</p>
</div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span></span>
<span>    <span class="va">landscape</span><span class="op">$</span><span class="va">precipitation</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>,</span>
<span>    col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html" class="external-link">hcl.colors</a></span><span class="op">(</span><span class="fl">100</span>, <span class="st">"GnBu"</span>, rev <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    main <span class="op">=</span> <span class="st">"Precipitation [mm]"</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="metaRange_files/figure-html/landscape_02-1.png" alt="Figure 4: The precipitation of the example landscape. Only the first layer of 10 identical ones is shown." width="700"><p class="caption">
Figure 4: The precipitation of the example landscape. Only the first
layer of 10 identical ones is shown.
</p>
</div>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span></span>
<span>    <span class="va">landscape</span><span class="op">$</span><span class="va">habitat</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>,</span>
<span>    main <span class="op">=</span> <span class="st">"Habitat quality [0-1]"</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="metaRange_files/figure-html/landscape_03-1.png" alt="Figure 5: The habitat quality of the example landscape. Only the first layer of 10 identical ones is shown." width="700"><p class="caption">
Figure 5: The habitat quality of the example landscape. Only the first
layer of 10 identical ones is shown.
</p>
</div>
</div>
<div class="section level2">
<h2 id="pre-setup">Pre-setup<a class="anchor" aria-label="anchor" href="#pre-setup"></a>
</h2>
<p>Before creating the simulation, it may be helpful to enable extensive
reporting, which will print out a lot of information each time a
metaRange function is called. This can be enabled or disabled at any
time (i.e. also while the simulation is running), but in order to
highlight what each function call in this tutorial does, we enable it at
the beginnig of the setup.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 0 = no reporting</span></span>
<span><span class="co"># 1 = a bit of info</span></span>
<span><span class="co"># 2 = very verbose</span></span>
<span><span class="fu"><a href="../reference/set_verbosity.html">set_verbosity</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="creating-the-simulation">Creating the simulation<a class="anchor" aria-label="anchor" href="#creating-the-simulation"></a>
</h2>
<p>After the landscape is loaded, the simulation can be created using
the <code><a href="../reference/create_simulation.html">create_simulation()</a></code> function. The only required
argument is <code>source_environment</code> which is the landscape /
environment <code>SDS</code> that was created in the first step. One can
optionally specify an ID for the simulation and a seed for the random
number generator.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_simulation.html">create_simulation</a></span><span class="op">(</span></span>
<span>    source_environment <span class="op">=</span> <span class="va">landscape</span>,</span>
<span>    ID <span class="op">=</span> <span class="st">"example_simulation"</span>,</span>
<span>    seed <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt; number of time steps: 10</span></span>
<span><span class="co">#&gt; time step layer mapping: 1, 2, 3, 4, 5, 6, 7, 8, 9, 10</span></span>
<span><span class="co">#&gt; added environment</span></span>
<span><span class="co">#&gt; class       : SpatRasterDataset </span></span>
<span><span class="co">#&gt; subdatasets : 3 </span></span>
<span><span class="co">#&gt; dimensions  : 100, 100 (nrow, ncol)</span></span>
<span><span class="co">#&gt; nlyr        : 10, 10, 10 </span></span>
<span><span class="co">#&gt; resolution  : 1, 1  (x, y)</span></span>
<span><span class="co">#&gt; extent      : 0, 100, 0, 100  (xmin, xmax, ymin, ymax)</span></span>
<span><span class="co">#&gt; coord. ref. :  </span></span>
<span><span class="co">#&gt; source(s)   : memory </span></span>
<span><span class="co">#&gt; names       : temperature, precipitation, habitat</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; created simulation: example_simulation</span></span></code></pre></div>
<p>If you want to inspect the simulation object, you can either print
it, to lists its fields and methods or use the <code><a href="https://rdrr.io/pkg/terra/man/summary.html" class="external-link">summary()</a></code>
function to get an overview of the simulation state.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim</span></span>
<span><span class="co">#&gt; metaRangeSimulation object</span></span>
<span><span class="co">#&gt; Fields: </span></span>
<span><span class="co">#&gt;   $ID</span></span>
<span><span class="co">#&gt;   $globals</span></span>
<span><span class="co">#&gt;   $environment</span></span>
<span><span class="co">#&gt;   $number_time_steps</span></span>
<span><span class="co">#&gt;   $time_step_layer</span></span>
<span><span class="co">#&gt;   $current_time_step</span></span>
<span><span class="co">#&gt;   $queue</span></span>
<span><span class="co">#&gt;   $processes</span></span>
<span><span class="co">#&gt;   $seed</span></span>
<span><span class="co">#&gt; Species: none</span></span>
<span><span class="co">#&gt; Methods: </span></span>
<span><span class="co">#&gt;   $species_names()</span></span>
<span><span class="co">#&gt;   $add_globals()</span></span>
<span><span class="co">#&gt;   $add_species()</span></span>
<span><span class="co">#&gt;   $add_traits()</span></span>
<span><span class="co">#&gt;   $add_process()</span></span>
<span><span class="co">#&gt;   $begin()</span></span>
<span><span class="co">#&gt;   $exit()</span></span>
<span><span class="co">#&gt;   $set_current_time_step()</span></span>
<span><span class="co">#&gt;   $set_time_layer_mapping()</span></span>
<span><span class="co">#&gt;   $print()</span></span>
<span><span class="co">#&gt;   $summary()</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">sim</span><span class="op">)</span></span>
<span><span class="co">#&gt; ID: example_simulation </span></span>
<span><span class="co">#&gt; Environment: </span></span>
<span><span class="co">#&gt; class       : SpatRasterDataset </span></span>
<span><span class="co">#&gt; subdatasets : 3 </span></span>
<span><span class="co">#&gt; dimensions  : 100, 100 (nrow, ncol)</span></span>
<span><span class="co">#&gt; nlyr        : 10, 10, 10 </span></span>
<span><span class="co">#&gt; resolution  : 1, 1  (x, y)</span></span>
<span><span class="co">#&gt; extent      : 0, 100, 0, 100  (xmin, xmax, ymin, ymax)</span></span>
<span><span class="co">#&gt; coord. ref. :  </span></span>
<span><span class="co">#&gt; source(s)   : memory </span></span>
<span><span class="co">#&gt; names       : temperature, precipitation, habitat </span></span>
<span><span class="co">#&gt; Time step layer mapping:  1 2 3 4 5 6 7 8 9 10 </span></span>
<span><span class="co">#&gt; Current time step:  1 </span></span>
<span><span class="co">#&gt; Seed:  1 </span></span>
<span><span class="co">#&gt; Species:</span></span>
<span><span class="co">#&gt;   </span></span>
<span><span class="co">#&gt; Simulation level processes:</span></span>
<span><span class="co">#&gt; NULL</span></span>
<span><span class="co">#&gt; Gobal variables:</span></span>
<span><span class="co">#&gt; NULL</span></span>
<span><span class="co">#&gt; Queue:</span></span>
<span><span class="co">#&gt; At process:  0 out of:  0 </span></span>
<span><span class="co">#&gt; Remaining queue: </span></span>
<span><span class="co">#&gt; --- empty </span></span>
<span><span class="co">#&gt; Future (next time step) queue: </span></span>
<span><span class="co">#&gt; --- empty</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="adding-species-to-the-simulation">Adding species to the simulation<a class="anchor" aria-label="anchor" href="#adding-species-to-the-simulation"></a>
</h2>
<p>After the simulation is created, species can be added to it using the
<code>add_species()</code> function. At this point one has to switch to
the earlier mentioned R6 syntax. This means that
<code>add_species()</code> is a method of the <code>simulation</code>
object and can be called using the <code>$</code> operator (i.e. by
indexing the simulation object and calling a function that is stored
inside of it). The only required argument is <code>name</code> which is
the name of the species that will be added.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim</span><span class="op">$</span><span class="fu">add_species</span><span class="op">(</span>name <span class="op">=</span> <span class="st">"species_1"</span><span class="op">)</span></span>
<span><span class="co">#&gt; adding species</span></span>
<span><span class="co">#&gt; Name: species_1</span></span></code></pre></div>
<p>This species can now be accessed by using the <code>$</code> operator
again.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim</span><span class="op">$</span><span class="va">species_1</span></span>
<span><span class="co">#&gt; Species:  species_1 </span></span>
<span><span class="co">#&gt; processes: </span></span>
<span><span class="co">#&gt; NULL</span></span>
<span><span class="co">#&gt; traits: </span></span>
<span><span class="co">#&gt; character(0)</span></span></code></pre></div>
<p>If you want to add more species, you can just repeat the
<code>add_species()</code> call.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim</span><span class="op">$</span><span class="fu">add_species</span><span class="op">(</span>name <span class="op">=</span> <span class="st">"species_2"</span><span class="op">)</span></span>
<span><span class="co">#&gt; adding species</span></span>
<span><span class="co">#&gt; Name: species_2</span></span></code></pre></div>
<p>If you are at any point wondering which, or how many species are in
the simulation, you can use the <code>species_names()</code> method.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim</span><span class="op">$</span><span class="fu">species_names</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "species_2" "species_1"</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="adding-traits-to-species">Adding traits to species<a class="anchor" aria-label="anchor" href="#adding-traits-to-species"></a>
</h2>
<p>After species are added to the simulation, traits can be asigned to
them using the <code>add_traits()</code> method. This function is able
to add (multiple) traits to multiple species at once, which is useful
when setting up a large number of species with the same traits. The
first argument is <code>species</code> which is a character vector of
the species names to which the trait should be assigned to. The second
argument is <code>population_level</code>, which decides on what “level”
the trait should be added. If <code>TRUE</code>, the trait will be
expanded to fill the whole landscape (i.e. one value per population).
All following arguments can be supplied in the form of
<code>trait_name = trait_value</code>.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim</span><span class="op">$</span><span class="fu">add_traits</span><span class="op">(</span></span>
<span>    species <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"species_1"</span>, <span class="st">"species_2"</span><span class="op">)</span>,</span>
<span>    population_level <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    abundance <span class="op">=</span> <span class="fl">500</span>,</span>
<span>    climate_suitability <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    reproduction_rate <span class="op">=</span> <span class="fl">0.3</span>,</span>
<span>    carrying_capacity <span class="op">=</span> <span class="fl">1000</span></span>
<span>    <span class="co"># ...</span></span>
<span>    <span class="co"># Note that here could be more traits, there is no limit</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; adding traits:</span></span>
<span><span class="co">#&gt; [1] "abundance"           "climate_suitability" "reproduction_rate"  </span></span>
<span><span class="co">#&gt; [4] "carrying_capacity"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; to species:</span></span>
<span><span class="co">#&gt; [1] "species_1" "species_2"</span></span>
<span><span class="co">#&gt; </span></span></code></pre></div>
<p>Some traits may not require to be stored at the population level,
e.g. if they are a property of the species as a whole. In this case,
<code>population_level</code> can be set to <code>FALSE</code> and the
trait will be added as-is, without further processing. For this example
we assume that both species have the same dispersal kernel that it is
constant over the whole landscape (i.e. the same for each population).
In case one is unfamiliar with the concept of dispersal kernels, a good
introduction is <a href="https://doi.org/10.1093/acprof%3Aoso/9780199608898.003.0015" class="external-link">“Nathan,
R., Klein, E., Robledo-Arnuncio, J.J. &amp; Revilla, E. (2012) Dispersal
kernels: review”</a> [Ref. 1], but on a basic level, a dispersal kernel
is a matrix that describes the dispersal probability from a source
population to its surrounding habitat. We can use the function
<code><a href="../reference/calculate_dispersal_kernel.html">calculate_dispersal_kernel()</a></code> to create such a dispersal
kernel and then add it to both species. Note that we can call
<code><a href="../reference/calculate_dispersal_kernel.html">calculate_dispersal_kernel()</a></code> directly in the
<code>add_traits()</code> call.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim</span><span class="op">$</span><span class="fu">add_traits</span><span class="op">(</span></span>
<span>    species <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"species_1"</span>, <span class="st">"species_2"</span><span class="op">)</span>,</span>
<span>    population_level <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    dispersal_kernel <span class="op">=</span> <span class="fu"><a href="../reference/calculate_dispersal_kernel.html">calculate_dispersal_kernel</a></span><span class="op">(</span></span>
<span>        <span class="co"># in grid cells</span></span>
<span>        max_dispersal_dist <span class="op">=</span> <span class="fl">3</span>,</span>
<span>        <span class="co"># the function to use to calculate the kernel values</span></span>
<span>        kfun <span class="op">=</span> <span class="va">negative_exponential_function</span>,</span>
<span>        <span class="co"># in grid cells</span></span>
<span>        mean_dispersal_dist <span class="op">=</span> <span class="fl">1</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; adding traits:</span></span>
<span><span class="co">#&gt; [1] "dispersal_kernel"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; to species:</span></span>
<span><span class="co">#&gt; [1] "species_1" "species_2"</span></span>
<span><span class="co">#&gt; </span></span></code></pre></div>
<p>Assuming we are interested to find out how the two species would
inhabit our landscape, we can give both of them different environmental
preferences for the two envionmental variables in the simulation
environment (temperature &amp; precipitation). Note that the names of
the traits are arbitrary and can be chosen by the user and that there is
no predetermined connection between e.g. “min_temperature” and the
temperature variable in the environment. It is the responsibility of the
species processes (therfore of the user) to access the correct traits
and use them in the correct way, which is why meaningfull trait names
are important.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim</span><span class="op">$</span><span class="fu">add_traits</span><span class="op">(</span></span>
<span>    species <span class="op">=</span> <span class="st">"species_1"</span>,</span>
<span>    population_level <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    max_temperature <span class="op">=</span> <span class="fl">300</span>, <span class="co"># Kelvin</span></span>
<span>    optimal_temperature <span class="op">=</span> <span class="fl">288</span>,</span>
<span>    min_temperature <span class="op">=</span> <span class="fl">280</span>,</span>
<span>    max_precipitation <span class="op">=</span> <span class="fl">1000</span>, <span class="co"># mm</span></span>
<span>    optimal_precipitation <span class="op">=</span> <span class="fl">700</span>,</span>
<span>    min_precipitation <span class="op">=</span> <span class="fl">200</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; adding traits:</span></span>
<span><span class="co">#&gt; [1] "max_temperature"       "optimal_temperature"   "min_temperature"      </span></span>
<span><span class="co">#&gt; [4] "max_precipitation"     "optimal_precipitation" "min_precipitation"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; to species:</span></span>
<span><span class="co">#&gt; [1] "species_1"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="va">sim</span><span class="op">$</span><span class="fu">add_traits</span><span class="op">(</span></span>
<span>    species <span class="op">=</span> <span class="st">"species_2"</span>,</span>
<span>    population_level <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    max_temperature <span class="op">=</span> <span class="fl">290</span>,</span>
<span>    optimal_temperature <span class="op">=</span> <span class="fl">285</span>,</span>
<span>    min_temperature <span class="op">=</span> <span class="fl">270</span>,</span>
<span>    max_precipitation <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>    optimal_precipitation <span class="op">=</span> <span class="fl">500</span>,</span>
<span>    min_precipitation <span class="op">=</span> <span class="fl">0</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; adding traits:</span></span>
<span><span class="co">#&gt; [1] "max_temperature"       "optimal_temperature"   "min_temperature"      </span></span>
<span><span class="co">#&gt; [4] "max_precipitation"     "optimal_precipitation" "min_precipitation"</span></span>
<span><span class="co">#&gt; to species:</span></span>
<span><span class="co">#&gt; [1] "species_2"</span></span>
<span><span class="co">#&gt; </span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="adding-processes">Adding processes<a class="anchor" aria-label="anchor" href="#adding-processes"></a>
</h2>
<p>After the species and their traits are added, the processes that
describe the species interaction with their environment can be added,
using the <code>add_processes()</code> method. The arguments are:
<code>species</code> which is a character vector of the species that
should get the process, <code>process_name</code> which is a human
readable name for the process and <code>process_fun</code> which is the
function that will be executed when the process is called. One argument
that might be confusing is the <code>execution_priority</code>. This is
a number that gives the process a priority “weight” and decides in which
order the processes are executed within one time step. The smaller the
number, the earlier the process will be executed (e.g. 1 gets executed
before 2). In the case two processes have the same priority, it is
assumed that they are independent from each other and that their
execution order doesn’t matter. They will be executed in alphabetical
order. (Technical note: Don’t count on this behavior, it may change in
the future. Equal priority means it should not matter in what order they
are executed).</p>
<p>In this example we will first add three basic processes to each
species, one for estimating the suitability of a habitat cell, one that
calculates the population growth and one that describes the dispersal.
To calculate the suitability, we use the metaRange function
<code><a href="../reference/calculate_suitability.html">calculate_suitability()</a></code> that was adapted from a formula
published by <a href="https://doi.org/10.1016/0168-1923(95)02236-Q" class="external-link">Yin
et al. in 1995</a> [Ref. 2] and simplified by <a href="https://doi.org/10.1006/anbo.1999.0955" class="external-link">Yan and Hunt in 1999
(eq:4)</a> [Ref. 3]. The formula takes the three cardinal values of
environmental niche (minimum tolerable value, optimal vale and maximum
tolerable value) and constructs a suitability curve based on a beta
distribution. In the following code we do this for both the
precipitation and the temperature and then multiply the values to get a
joint suitability over the two environmental niches. The user could also
define their own function to calculate the suitability.</p>
<p>Note the use of the <code>self</code> keyword in the function. In
this context, <code>self</code> refers to the species that the process
is attached to. This means that the function can access the species
traits and modify them and also access the environment (each species
holds a reference to the simulation it was created in).</p>
<div class="section level3">
<h3 id="suitability">Suitability<a class="anchor" aria-label="anchor" href="#suitability"></a>
</h3>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim</span><span class="op">$</span><span class="fu">add_process</span><span class="op">(</span></span>
<span>    species <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"species_1"</span>, <span class="st">"species_2"</span><span class="op">)</span>,</span>
<span>    process_name <span class="op">=</span> <span class="st">"calculate_suitability"</span>,</span>
<span>    process_fun <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">self</span><span class="op">$</span><span class="va">traits</span><span class="op">$</span><span class="va">climate_suitability</span> <span class="op">&lt;-</span></span>
<span>            <span class="fu"><a href="../reference/calculate_suitability.html">calculate_suitability</a></span><span class="op">(</span></span>
<span>                <span class="va">self</span><span class="op">$</span><span class="va">traits</span><span class="op">$</span><span class="va">max_temperature</span>,</span>
<span>                <span class="va">self</span><span class="op">$</span><span class="va">traits</span><span class="op">$</span><span class="va">optimal_temperature</span>,</span>
<span>                <span class="va">self</span><span class="op">$</span><span class="va">traits</span><span class="op">$</span><span class="va">min_temperature</span>,</span>
<span>                <span class="co"># The following acceses the "current" environment</span></span>
<span>                <span class="co"># of a time step</span></span>
<span>                <span class="co"># (i.e. from the raster layer, that corresponds</span></span>
<span>                <span class="co"># to the current time step)</span></span>
<span>                <span class="co"># For user convenice, this "current" environment</span></span>
<span>                <span class="co"># is converted to a plain matrix,</span></span>
<span>                <span class="co"># to allow easier calculations</span></span>
<span>                <span class="va">self</span><span class="op">$</span><span class="va">sim</span><span class="op">$</span><span class="va">environment</span><span class="op">$</span><span class="va">current</span><span class="op">$</span><span class="va">temperature</span></span>
<span>            <span class="op">)</span> <span class="op">*</span></span>
<span>            <span class="fu"><a href="../reference/calculate_suitability.html">calculate_suitability</a></span><span class="op">(</span></span>
<span>                <span class="va">self</span><span class="op">$</span><span class="va">traits</span><span class="op">$</span><span class="va">max_precipitation</span>,</span>
<span>                <span class="va">self</span><span class="op">$</span><span class="va">traits</span><span class="op">$</span><span class="va">optimal_precipitation</span>,</span>
<span>                <span class="va">self</span><span class="op">$</span><span class="va">traits</span><span class="op">$</span><span class="va">min_precipitation</span>,</span>
<span>                <span class="va">self</span><span class="op">$</span><span class="va">sim</span><span class="op">$</span><span class="va">environment</span><span class="op">$</span><span class="va">current</span><span class="op">$</span><span class="va">precipitation</span></span>
<span>            <span class="op">)</span></span>
<span>    <span class="op">}</span>,</span>
<span>    execution_priority <span class="op">=</span> <span class="fl">1</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; adding process: calculate_suitability</span></span>
<span><span class="co">#&gt; to species:</span></span>
<span><span class="co">#&gt; [1] "species_1" "species_2"</span></span>
<span><span class="co">#&gt; </span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="reproduction">Reproduction<a class="anchor" aria-label="anchor" href="#reproduction"></a>
</h3>
<p>For the reproduction process we can use a built in function
<code><a href="../reference/ricker_reproduction_model.html">ricker_reproduction_model()</a></code> that implements the “classic”
Ricker reproduction model (<a href="https://doi.org/10.1139/f54-039" class="external-link">Ricker, W.E. (1954)</a> compare
also: <a href="https://doi.org/10.1111/j.1466-8238.2009.00492.x" class="external-link">Cabral,
J.S. and Schurr, F.M. (2010)</a>) [Ref. 4 &amp; 5].</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim</span><span class="op">$</span><span class="fu">add_process</span><span class="op">(</span></span>
<span>    species <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"species_1"</span>, <span class="st">"species_2"</span><span class="op">)</span>,</span>
<span>    process_name <span class="op">=</span> <span class="st">"reproduction"</span>,</span>
<span>    process_fun <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="co"># first let the carrying capacity</span></span>
<span>        <span class="co"># depend on the climate suitability</span></span>
<span>        <span class="va">self</span><span class="op">$</span><span class="va">traits</span><span class="op">$</span><span class="va">carrying_capacity</span> <span class="op">&lt;-</span></span>
<span>            <span class="va">self</span><span class="op">$</span><span class="va">traits</span><span class="op">$</span><span class="va">carrying_capacity</span> <span class="op">*</span></span>
<span>            <span class="va">self</span><span class="op">$</span><span class="va">traits</span><span class="op">$</span><span class="va">climate_suitability</span></span>
<span></span>
<span>        <span class="co"># let the reproduction rate</span></span>
<span>        <span class="co"># depend on the habitat quality</span></span>
<span>        <span class="va">self</span><span class="op">$</span><span class="va">traits</span><span class="op">$</span><span class="va">reproduction_rate</span> <span class="op">&lt;-</span></span>
<span>            <span class="va">self</span><span class="op">$</span><span class="va">traits</span><span class="op">$</span><span class="va">reproduction_rate</span> <span class="op">*</span></span>
<span>            <span class="va">self</span><span class="op">$</span><span class="va">sim</span><span class="op">$</span><span class="va">environment</span><span class="op">$</span><span class="va">current</span><span class="op">$</span><span class="va">habitat</span></span>
<span></span>
<span>        <span class="co"># use a ricker reproduction model</span></span>
<span>        <span class="co"># to calculate the new abundance</span></span>
<span>        <span class="va">self</span><span class="op">$</span><span class="va">traits</span><span class="op">$</span><span class="va">abundance</span> <span class="op">&lt;-</span></span>
<span>            <span class="fu"><a href="../reference/ricker_reproduction_model.html">ricker_reproduction_model</a></span><span class="op">(</span></span>
<span>                <span class="va">self</span><span class="op">$</span><span class="va">traits</span><span class="op">$</span><span class="va">abundance</span>,</span>
<span>                <span class="va">self</span><span class="op">$</span><span class="va">traits</span><span class="op">$</span><span class="va">reproduction_rate</span>,</span>
<span>                <span class="va">self</span><span class="op">$</span><span class="va">traits</span><span class="op">$</span><span class="va">carrying_capacity</span></span>
<span>            <span class="op">)</span></span>
<span>    <span class="op">}</span>,</span>
<span>    execution_priority <span class="op">=</span> <span class="fl">2</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; adding process: reproduction</span></span>
<span><span class="co">#&gt; to species:</span></span>
<span><span class="co">#&gt; [1] "species_1" "species_2"</span></span>
<span><span class="co">#&gt; </span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="dispersal">Dispersal<a class="anchor" aria-label="anchor" href="#dispersal"></a>
</h3>
<p>To apply the dispersal kernel to the abundance of the species, we can
use the <code><a href="../reference/dispersal.html">dispersal()</a></code> function. It takes the dispersal kernel
and applies it to each population (grid cell) of the species and then
returns the dispersed abundance. In other fields this process is known
as a 2D convolution and e.g. used when blurring an image. Therfore one
can think of the dispersal in a similar way, as a “blurring” of the
species abundance over the landscape. Note that you can also use
<code>[[</code> indexing to access the traits of a species (which is
actually slightly faster than <code>$</code> indexing).</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim</span><span class="op">$</span><span class="fu">add_process</span><span class="op">(</span></span>
<span>    species <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"species_1"</span>, <span class="st">"species_2"</span><span class="op">)</span>,</span>
<span>    process_name <span class="op">=</span> <span class="st">"dispersal_process"</span>,</span>
<span>    process_fun <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">self</span><span class="op">$</span><span class="va">traits</span><span class="op">[[</span><span class="st">"abundance"</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dispersal.html">dispersal</a></span><span class="op">(</span></span>
<span>            abundance <span class="op">=</span> <span class="va">self</span><span class="op">$</span><span class="va">traits</span><span class="op">[[</span><span class="st">"abundance"</span><span class="op">]</span><span class="op">]</span>,</span>
<span>            dispersal_kernel <span class="op">=</span> <span class="va">self</span><span class="op">$</span><span class="va">traits</span><span class="op">[[</span><span class="st">"dispersal_kernel"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span>    <span class="op">}</span>,</span>
<span>    execution_priority <span class="op">=</span> <span class="fl">3</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; adding process: dispersal_process</span></span>
<span><span class="co">#&gt; to species:</span></span>
<span><span class="co">#&gt; [1] "species_1" "species_2"</span></span>
<span><span class="co">#&gt; </span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="executing-the-simulation">Executing the simulation<a class="anchor" aria-label="anchor" href="#executing-the-simulation"></a>
</h2>
<p>After all species, traits and processes are added to the simulation,
it can be executed via the <code>begin()</code> method. To reduce the
amount of output while the simulation is running, we’ll set the
verbosity to 1.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/set_verbosity.html">set_verbosity</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">sim</span><span class="op">$</span><span class="fu">begin</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Starting simualtion.</span></span>
<span><span class="co">#&gt; start of time step: 1</span></span>
<span><span class="co">#&gt; end of time step: 1</span></span>
<span><span class="co">#&gt; 0.41 secs remaining (estimate)</span></span>
<span><span class="co">#&gt; 10 % done</span></span>
<span><span class="co">#&gt; start of time step: 2</span></span>
<span><span class="co">#&gt; end of time step: 2</span></span>
<span><span class="co">#&gt; 0.58 secs remaining (estimate)</span></span>
<span><span class="co">#&gt; 20 % done</span></span>
<span><span class="co">#&gt; start of time step: 3</span></span>
<span><span class="co">#&gt; end of time step: 3</span></span>
<span><span class="co">#&gt; 0.34 secs remaining (estimate)</span></span>
<span><span class="co">#&gt; 30 % done</span></span>
<span><span class="co">#&gt; start of time step: 4</span></span>
<span><span class="co">#&gt; end of time step: 4</span></span>
<span><span class="co">#&gt; 0.28 secs remaining (estimate)</span></span>
<span><span class="co">#&gt; 40 % done</span></span>
<span><span class="co">#&gt; start of time step: 5</span></span>
<span><span class="co">#&gt; end of time step: 5</span></span>
<span><span class="co">#&gt; 0.22 secs remaining (estimate)</span></span>
<span><span class="co">#&gt; 50 % done</span></span>
<span><span class="co">#&gt; start of time step: 6</span></span>
<span><span class="co">#&gt; end of time step: 6</span></span>
<span><span class="co">#&gt; 0.22 secs remaining (estimate)</span></span>
<span><span class="co">#&gt; 60 % done</span></span>
<span><span class="co">#&gt; start of time step: 7</span></span>
<span><span class="co">#&gt; end of time step: 7</span></span>
<span><span class="co">#&gt; 0.16 secs remaining (estimate)</span></span>
<span><span class="co">#&gt; 70 % done</span></span>
<span><span class="co">#&gt; start of time step: 8</span></span>
<span><span class="co">#&gt; end of time step: 8</span></span>
<span><span class="co">#&gt; 0.1 secs remaining (estimate)</span></span>
<span><span class="co">#&gt; 80 % done</span></span>
<span><span class="co">#&gt; start of time step: 9</span></span>
<span><span class="co">#&gt; end of time step: 9</span></span>
<span><span class="co">#&gt; 0.043 secs remaining (estimate)</span></span>
<span><span class="co">#&gt; 90 % done</span></span>
<span><span class="co">#&gt; start of time step: 10</span></span>
<span><span class="co">#&gt; end of time step: 10</span></span>
<span><span class="co">#&gt; 0 secs remaining (estimate)</span></span>
<span><span class="co">#&gt; 100 % done</span></span>
<span><span class="co">#&gt; Simulation: 'example_simulation' finished</span></span>
<span><span class="co">#&gt; Exiting the Simulation</span></span>
<span><span class="co">#&gt; Runtime: 0.52 secs</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="plotting-the-results">Plotting the results<a class="anchor" aria-label="anchor" href="#plotting-the-results"></a>
</h2>
<p>To investigate the results, you can use the <code><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot()</a></code>
function. Note that the following two functions essentially plot the
same, the only difference is that the first one calls
<code><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot()</a></code> on the simulation object while the second one calls
<code><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot()</a></code> on the species object</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># define a nice color palette</span></span>
<span><span class="va">plot_cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html" class="external-link">hcl.colors</a></span><span class="op">(</span><span class="fl">100</span>, <span class="st">"Purple-Yellow"</span>, rev <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span></span>
<span>    <span class="va">sim</span>,</span>
<span>    obj <span class="op">=</span> <span class="st">"species_1"</span>,</span>
<span>    name <span class="op">=</span> <span class="st">"abundance"</span>,</span>
<span>    main <span class="op">=</span> <span class="st">"Species 1: abundance"</span>,</span>
<span>    col <span class="op">=</span> <span class="va">plot_cols</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="metaRange_files/figure-html/resA-1.png" alt="Figure 6: The resulting abundance distribution of species 1 after 10 simulation time steps." width="700"><p class="caption">
Figure 6: The resulting abundance distribution of species 1 after 10
simulation time steps.
</p>
</div>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span></span>
<span>    <span class="va">sim</span><span class="op">$</span><span class="va">species_2</span>,</span>
<span>    trait <span class="op">=</span> <span class="st">"abundance"</span>,</span>
<span>    main <span class="op">=</span> <span class="st">"Species 2: abundance"</span>,</span>
<span>    col <span class="op">=</span> <span class="va">plot_cols</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="metaRange_files/figure-html/resB-1.png" alt="Figure 7: The resulting abundance distribution of species 2 after 10 simulation time steps." width="700"><p class="caption">
Figure 7: The resulting abundance distribution of species 2 after 10
simulation time steps.
</p>
</div>
</div>
<div class="section level2">
<h2 id="saving-the-simulation">Saving the simulation<a class="anchor" aria-label="anchor" href="#saving-the-simulation"></a>
</h2>
<p>To save results you can use the <code><a href="../reference/save_species.html">save_species()</a></code> function.
This will save the (possibly specified) traits of a species, either as a
raster (.tif) or as a text (.csv) file, whatever is more appropriate for
the data. Note that this function does <em>not</em> save the species
processes. One should keep a copy of the script that is used to run the
simulation to make it repeatable.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/save_species.html">save_species</a></span><span class="op">(</span></span>
<span>    <span class="va">sim</span><span class="op">$</span><span class="va">species_1</span>,</span>
<span>    traits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"name"</span>, <span class="st">"of"</span>, <span class="st">"one_or_more"</span>, <span class="st">"traits"</span><span class="op">)</span>,</span>
<span>    path <span class="op">=</span> <span class="st">"path/to/a/folder/"</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<ol style="list-style-type: decimal">
<li><p>Nathan, R., Klein, E., Robledo-Arnuncio, J.J. and Revilla, E.
(2012) Dispersal kernels: review. in: Dispersal Ecology and Evolution
pp. 187–210. (eds J. Clobert, M. Baguette, T.G. Benton and J.M.
Bullock), Oxford, UK: Oxford Academic, 2013. <a href="doi:10.1093/acprof:oso/9780199608898.003.0015" class="uri">doi:10.1093/acprof:oso/9780199608898.003.0015</a></p></li>
<li><p>Yin, X., Kropff, M.J., McLaren, G., Visperas, R.M., (1995) A
nonlinear model for crop development as a function of temperature,
Agricultural and Forest Meteorology, Volume 77, Issues 1-2, Pages 1–16,
<a href="doi:10.1016/0168-1923(95)02236-Q" class="uri">doi:10.1016/0168-1923(95)02236-Q</a></p></li>
<li><p>Yan, W., Hunt, L.A. (1999) An Equation for Modelling the
Temperature Response of Plants using only the Cardinal Temperatures,
Annals of Botany, Volume 84, Issue 5, Pages 607–614, ISSN 0305-7364, <a href="doi:10.1006/anbo.1999.0955" class="uri">doi:10.1006/anbo.1999.0955</a></p></li>
<li><p>Ricker, W.E. (1954) Stock and recruitment. Journal of the
Fisheries Research Board of Canada, 11, 559–623. <a href="doi:10.1139/f54-039" class="uri">doi:10.1139/f54-039</a></p></li>
<li><p>Cabral, J.S. and Schurr, F.M. (2010) Estimating demographic
models for the range dynamics of plant species. Global Ecology and
Biogeography, 19, 85–97. <a href="doi:10.1111/j.1466-8238.2009.00492.x" class="uri">doi:10.1111/j.1466-8238.2009.00492.x</a></p></li>
</ol>
</div>
<div class="section level2">
<h2 id="appendix">Appendix<a class="anchor" aria-label="anchor" href="#appendix"></a>
</h2>
<p>Here is the function that is used to generate the example
landscape.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">create_example_landscape</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span></span>
<span>    <span class="va">create_land</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">sample_size</span> <span class="op">&lt;-</span> <span class="fl">100</span></span>
<span>        <span class="va">n_cells</span> <span class="op">&lt;-</span> <span class="fl">100</span></span>
<span>        <span class="va">res</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/disaggregate.html" class="external-link">disagg</a></span><span class="op">(</span></span>
<span>            <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/rast.html" class="external-link">rast</a></span><span class="op">(</span></span>
<span>                <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span></span>
<span>                    <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample.int</a></span><span class="op">(</span></span>
<span>                        <span class="va">sample_size</span>,</span>
<span>                        <span class="va">n_cells</span>,</span>
<span>                        replace <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                        prob <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">sin</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0.05</span>, <span class="va">pi</span><span class="op">-</span><span class="fl">0.05</span>, length.out <span class="op">=</span> <span class="va">sample_size</span><span class="op">)</span><span class="op">)</span></span>
<span>                    <span class="op">)</span>,</span>
<span>                    nrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">n_cells</span><span class="op">)</span>,</span>
<span>                    ncol <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">n_cells</span><span class="op">)</span></span>
<span>                <span class="op">)</span></span>
<span>            <span class="op">)</span>,</span>
<span>            <span class="fl">10</span>,</span>
<span>            <span class="st">"bilinear"</span></span>
<span>        <span class="op">)</span>  <span class="op">/</span> <span class="fl">100</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/pkg/terra/man/ext.html" class="external-link">ext</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">100</span>, <span class="fl">0</span>, <span class="fl">100</span><span class="op">)</span></span>
<span>        <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="va">temperature</span> <span class="op">&lt;-</span> <span class="fu">create_land</span><span class="op">(</span><span class="op">)</span> <span class="op">*</span> <span class="fl">20</span> <span class="op">+</span> <span class="fl">273.15</span></span>
<span>    <span class="va">temperature</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">temperature</span>, <span class="fl">10</span><span class="op">)</span></span>
<span>    <span class="va">precipitation</span> <span class="op">&lt;-</span> <span class="fu">create_land</span><span class="op">(</span><span class="op">)</span> <span class="op">*</span> <span class="fl">1000</span></span>
<span>    <span class="va">precipitation</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">precipitation</span>, <span class="fl">10</span><span class="op">)</span></span>
<span>    <span class="va">habitat</span> <span class="op">&lt;-</span> <span class="fu">create_land</span><span class="op">(</span><span class="op">)</span></span>
<span>    <span class="va">habitat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">habitat</span>, <span class="fl">10</span><span class="op">)</span></span>
<span>    <span class="va">landscape</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/sds.html" class="external-link">sds</a></span><span class="op">(</span><span class="va">temperature</span>, <span class="va">precipitation</span>, <span class="va">habitat</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">landscape</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"temperature"</span>, <span class="st">"precipitation"</span>, <span class="st">"habitat"</span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">landscape</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Stefan Fallert, Lea Li, Juliano Sarmento Cabral, Bavarian Ministry of Science and Arts (bayklif), Deutsche Bundesstiftung Umwelt (DBU).</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
