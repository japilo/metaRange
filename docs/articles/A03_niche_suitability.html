<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="metaRange">
<title>03: Niche suitability • metaRange</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="03: Niche suitability">
<meta property="og:description" content="metaRange">
<meta property="og:image" content="https://metaRange.github.io/metaRange/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">metaRange</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/A01_intro.html">01: Introduction to metaRange</a>
    <a class="dropdown-item" href="../articles/A02_multiple_species.html">02: Multiple species</a>
    <a class="dropdown-item" href="../articles/A03_niche_suitability.html">03: Niche suitability</a>
    <a class="dropdown-item" href="../articles/A04_dispersal.html">04: Dispersal</a>
    <a class="dropdown-item" href="../articles/A05_species_interactions.html">05: Species interactions</a>
    <a class="dropdown-item" href="../articles/A06_metabolic_scaling.html">06: Metabolic scaling</a>
    <a class="dropdown-item" href="../articles/A07_age_structured_populations.html">07: Age structured populations</a>
    <a class="dropdown-item" href="../articles/A08_advanced_options.html">08: Advanced options</a>
    <a class="dropdown-item" href="../articles/A09_troubleshooting_and_caveats.html">09: Troubleshooting / caveats</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/metaRange/metaRange/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>03: Niche suitability</h1>
                        <h4 data-toc-skip class="author">Fallert, S. and
Cabral, J.S.</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/metaRange/metaRange/blob/HEAD/vignettes/A03_niche_suitability.Rmd" class="external-link"><code>vignettes/A03_niche_suitability.Rmd</code></a></small>
      <div class="d-none name"><code>A03_niche_suitability.Rmd</code></div>
    </div>

    
    
<p>How environmental conditions influence the distribution of species is
a central study question in ecology. In this tutorial we will show how
to implement a simple niche suitability model in metaRange. For this, we
will create a landscape with two environmental variables (temperature
and precipitation) and then add two species to it, that have different
environmental preferences. We are going to give the two species the same
traits otherwise and then run the simulation for 10 time steps to see
the impact of the different environmental preferences.</p>
<div class="section level2">
<h2 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h2>
<p>First we load the packages and create the example landscape.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://metaRange.github.io/metaRange/">metaRange</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; metaRange version: 1.0.1</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/" class="external-link">terra</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; terra 1.7.55</span></span>
<span><span class="fu"><a href="../reference/set_verbosity.html">set_verbosity</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># find the example raster file</span></span>
<span><span class="va">raster_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"ex/elev.tif"</span>, package <span class="op">=</span> <span class="st">"terra"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># load it</span></span>
<span><span class="va">r</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="va">raster_file</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># adjust the values</span></span>
<span><span class="va">temperature</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="va">r</span>, center <span class="op">=</span> <span class="cn">FALSE</span>, scale <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">*</span> <span class="fl">10</span> <span class="op">+</span> <span class="fl">273.15</span></span>
<span><span class="va">precipitation</span> <span class="op">&lt;-</span> <span class="va">r</span> <span class="op">*</span> <span class="fl">2</span></span></code></pre></div>
<p>Now we can (again) turn the raster into an <code>SDS</code> with one
layer per time step.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">temperature</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">temperature</span>, <span class="fl">10</span><span class="op">)</span></span>
<span><span class="va">precipitation</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">precipitation</span>, <span class="fl">10</span><span class="op">)</span></span>
<span><span class="va">landscape</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/sds.html" class="external-link">sds</a></span><span class="op">(</span><span class="va">temperature</span>, <span class="va">precipitation</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">landscape</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"temperature"</span>, <span class="st">"precipitation"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span></span>
<span>    <span class="va">landscape</span><span class="op">$</span><span class="va">temperature</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>,</span>
<span>    col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html" class="external-link">hcl.colors</a></span><span class="op">(</span><span class="fl">100</span>, <span class="st">"RdYlBu"</span>, rev <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    main <span class="op">=</span> <span class="st">"Temperature [K]"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="A03_niche_suitability_files/figure-html/landscape_01-1.png" alt="Figure 1: The temperature of the example landscape. Only the first layer of 10 identical ones is shown." width="700"><p class="caption">
Figure 1: The temperature of the example landscape. Only the first layer
of 10 identical ones is shown.
</p>
</div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span></span>
<span>    <span class="va">landscape</span><span class="op">$</span><span class="va">precipitation</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>,</span>
<span>    col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html" class="external-link">hcl.colors</a></span><span class="op">(</span><span class="fl">100</span>, <span class="st">"Earth"</span><span class="op">)</span>,</span>
<span>    main <span class="op">=</span> <span class="st">"Precipitation [mm]"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="A03_niche_suitability_files/figure-html/landscape_02-1.png" alt="Figure 2: The precipitation of the example landscape. Only the first layer of 10 identical ones is shown." width="700"><p class="caption">
Figure 2: The precipitation of the example landscape. Only the first
layer of 10 identical ones is shown.
</p>
</div>
</div>
<div class="section level2">
<h2 id="creating-the-simulation-and-species">Creating the simulation and species<a class="anchor" aria-label="anchor" href="#creating-the-simulation-and-species"></a>
</h2>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_simulation.html">create_simulation</a></span><span class="op">(</span></span>
<span>    source_environment <span class="op">=</span> <span class="va">landscape</span>,</span>
<span>    ID <span class="op">=</span> <span class="st">"example_simulation"</span>,</span>
<span>    seed <span class="op">=</span> <span class="fl">1</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; number of time steps: 10</span></span>
<span><span class="co">#&gt; time step layer mapping: 1, 2, 3, 4, 5, 6, 7, 8, 9, 10</span></span>
<span><span class="co">#&gt; added environment</span></span>
<span><span class="co">#&gt; class       : SpatRasterDataset </span></span>
<span><span class="co">#&gt; subdatasets : 2 </span></span>
<span><span class="co">#&gt; dimensions  : 90, 95 (nrow, ncol)</span></span>
<span><span class="co">#&gt; nlyr        : 10, 10 </span></span>
<span><span class="co">#&gt; resolution  : 0.008333333, 0.008333333  (x, y)</span></span>
<span><span class="co">#&gt; extent      : 5.741667, 6.533333, 49.44167, 50.19167  (xmin, xmax, ymin, ymax)</span></span>
<span><span class="co">#&gt; coord. ref. : lon/lat WGS 84 (EPSG:4326) </span></span>
<span><span class="co">#&gt; source(s)   : memory </span></span>
<span><span class="co">#&gt; names       : temperature, precipitation</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; created simulation: example_simulation</span></span>
<span><span class="va">sim</span><span class="op">$</span><span class="fu">add_species</span><span class="op">(</span>name <span class="op">=</span> <span class="st">"species_1"</span><span class="op">)</span></span>
<span><span class="co">#&gt; adding species</span></span>
<span><span class="co">#&gt; Name: species_1</span></span>
<span><span class="va">sim</span><span class="op">$</span><span class="fu">add_species</span><span class="op">(</span>name <span class="op">=</span> <span class="st">"species_2"</span><span class="op">)</span></span>
<span><span class="co">#&gt; adding species</span></span>
<span><span class="co">#&gt; Name: species_2</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="adding-traits-to-species">Adding traits to species<a class="anchor" aria-label="anchor" href="#adding-traits-to-species"></a>
</h2>
<p>To start, we add the same traits as in the previous tutorials and
also add a trait called <code>climate_suitability</code>, where we will
store the information about how suitable the environment in each cell is
for the population that lives there.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim</span><span class="op">$</span><span class="fu">add_traits</span><span class="op">(</span></span>
<span>    species <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"species_1"</span>, <span class="st">"species_2"</span><span class="op">)</span>,</span>
<span>    population_level <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    abundance <span class="op">=</span> <span class="fl">500</span>,</span>
<span>    climate_suitability <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    reproduction_rate <span class="op">=</span> <span class="fl">0.3</span>,</span>
<span>    carrying_capacity <span class="op">=</span> <span class="fl">1000</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; adding traits:</span></span>
<span><span class="co">#&gt; [1] "abundance"           "climate_suitability" "reproduction_rate"  </span></span>
<span><span class="co">#&gt; [4] "carrying_capacity"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; to species:</span></span>
<span><span class="co">#&gt; [1] "species_1" "species_2"</span></span>
<span><span class="co">#&gt; </span></span></code></pre></div>
<p>Contrary to the above, some traits may not require to be stored at
the population level. In this example, this could be the case for the
environmental preferences of a species. If we assume that they are a
property of the species as a whole (i.e. the same for all populations),
we can set the parameter <code>population_level</code> to
<code>FALSE</code> and the traits will be added as they are, without
further processing.</p>
<p>In order to make the simulation more interesting, we can give both
species different environmental preferences for the two environmental
variables in the simulation environment (temperature &amp;
precipitation).</p>
<p>Note that the names of the traits are arbitrary and can be chosen by
the user and that there is no predetermined connection between
e.g. “min_temperature” and the temperature variable in the environment.
To establish these connections, the user needs to add species processes
that access the correct traits and use them in a sensible way. This is
why meaningful trait names are important.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim</span><span class="op">$</span><span class="fu">add_traits</span><span class="op">(</span></span>
<span>    species <span class="op">=</span> <span class="st">"species_1"</span>,</span>
<span>    population_level <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    max_temperature <span class="op">=</span> <span class="fl">300</span>, <span class="co"># Kelvin</span></span>
<span>    optimal_temperature <span class="op">=</span> <span class="fl">288</span>,</span>
<span>    min_temperature <span class="op">=</span> <span class="fl">280</span>,</span>
<span>    max_precipitation <span class="op">=</span> <span class="fl">1000</span>, <span class="co"># mm</span></span>
<span>    optimal_precipitation <span class="op">=</span> <span class="fl">700</span>,</span>
<span>    min_precipitation <span class="op">=</span> <span class="fl">200</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; adding traits:</span></span>
<span><span class="co">#&gt; [1] "max_temperature"       "optimal_temperature"   "min_temperature"      </span></span>
<span><span class="co">#&gt; [4] "max_precipitation"     "optimal_precipitation" "min_precipitation"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; to species:</span></span>
<span><span class="co">#&gt; [1] "species_1"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="va">sim</span><span class="op">$</span><span class="fu">add_traits</span><span class="op">(</span></span>
<span>    species <span class="op">=</span> <span class="st">"species_2"</span>,</span>
<span>    population_level <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    max_temperature <span class="op">=</span> <span class="fl">290</span>,</span>
<span>    optimal_temperature <span class="op">=</span> <span class="fl">285</span>,</span>
<span>    min_temperature <span class="op">=</span> <span class="fl">270</span>,</span>
<span>    max_precipitation <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>    optimal_precipitation <span class="op">=</span> <span class="fl">500</span>,</span>
<span>    min_precipitation <span class="op">=</span> <span class="fl">0</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; adding traits:</span></span>
<span><span class="co">#&gt; [1] "max_temperature"       "optimal_temperature"   "min_temperature"      </span></span>
<span><span class="co">#&gt; [4] "max_precipitation"     "optimal_precipitation" "min_precipitation"</span></span>
<span><span class="co">#&gt; to species:</span></span>
<span><span class="co">#&gt; [1] "species_2"</span></span>
<span><span class="co">#&gt; </span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="adding-processes">Adding processes<a class="anchor" aria-label="anchor" href="#adding-processes"></a>
</h2>
<div class="section level3">
<h3 id="calculate-the-suitability">Calculate the suitability<a class="anchor" aria-label="anchor" href="#calculate-the-suitability"></a>
</h3>
<p>To calculate the suitability, we use the metaRange function
<code><a href="../reference/calculate_suitability.html">calculate_suitability()</a></code> that was adapted from a formula
published by Yin et al. in 1995 (Ref. 1) and simplified by Yan and Hunt
in 1999 (eq:4 in Ref. 2). The formula takes the three cardinal values of
an environmental niche (minimum tolerable value, optimal vale and
maximum tolerable value) and constructs a suitability curve based on a
beta distribution.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">min_value</span> <span class="op">&lt;-</span> <span class="fl">270</span></span>
<span><span class="va">opt_value</span> <span class="op">&lt;-</span> <span class="fl">285</span></span>
<span><span class="va">max_value</span> <span class="op">&lt;-</span> <span class="fl">290</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="va">min_value</span>, <span class="va">max_value</span>, length.out <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calculate_suitability.html">calculate_suitability</a></span><span class="op">(</span><span class="va">max_value</span>, <span class="va">opt_value</span>, <span class="va">min_value</span>, <span class="va">x</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, type <span class="op">=</span> <span class="st">"l"</span>, xlab <span class="op">=</span> <span class="st">"Temperature [K]"</span>, ylab <span class="op">=</span> <span class="st">"Suitability"</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="A03_niche_suitability_files/figure-html/calculate_suitability-1.png" alt="Figure 3: Example suitability curve for the temperature niche of species 2." width="700"><p class="caption">
Figure 3: Example suitability curve for the temperature niche of species
2.
</p>
</div>
<p>In the following code we add a process to both species that
calculates the environmental suitability for precipitation and
temperature and then multiplies the values to create a joint suitability
over the two niches. Note that one could also define a custom function
to calculate the suitability, if this built-in function does not
adequately describe the ecology of the target species.</p>
</div>
<div class="section level3">
<h3 id="suitability">Suitability<a class="anchor" aria-label="anchor" href="#suitability"></a>
</h3>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim</span><span class="op">$</span><span class="fu">add_process</span><span class="op">(</span></span>
<span>    species <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"species_1"</span>, <span class="st">"species_2"</span><span class="op">)</span>,</span>
<span>    process_name <span class="op">=</span> <span class="st">"calculate_suitability"</span>,</span>
<span>    process_fun <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">self</span><span class="op">$</span><span class="va">traits</span><span class="op">$</span><span class="va">climate_suitability</span> <span class="op">&lt;-</span></span>
<span>            <span class="fu"><a href="../reference/calculate_suitability.html">calculate_suitability</a></span><span class="op">(</span></span>
<span>                <span class="va">self</span><span class="op">$</span><span class="va">traits</span><span class="op">$</span><span class="va">max_temperature</span>,</span>
<span>                <span class="va">self</span><span class="op">$</span><span class="va">traits</span><span class="op">$</span><span class="va">optimal_temperature</span>,</span>
<span>                <span class="va">self</span><span class="op">$</span><span class="va">traits</span><span class="op">$</span><span class="va">min_temperature</span>,</span>
<span>                <span class="va">self</span><span class="op">$</span><span class="va">sim</span><span class="op">$</span><span class="va">environment</span><span class="op">$</span><span class="va">current</span><span class="op">$</span><span class="va">temperature</span></span>
<span>            <span class="op">)</span> <span class="op">*</span></span>
<span>            <span class="fu"><a href="../reference/calculate_suitability.html">calculate_suitability</a></span><span class="op">(</span></span>
<span>                <span class="va">self</span><span class="op">$</span><span class="va">traits</span><span class="op">$</span><span class="va">max_precipitation</span>,</span>
<span>                <span class="va">self</span><span class="op">$</span><span class="va">traits</span><span class="op">$</span><span class="va">optimal_precipitation</span>,</span>
<span>                <span class="va">self</span><span class="op">$</span><span class="va">traits</span><span class="op">$</span><span class="va">min_precipitation</span>,</span>
<span>                <span class="va">self</span><span class="op">$</span><span class="va">sim</span><span class="op">$</span><span class="va">environment</span><span class="op">$</span><span class="va">current</span><span class="op">$</span><span class="va">precipitation</span></span>
<span>            <span class="op">)</span></span>
<span>    <span class="op">}</span>,</span>
<span>    execution_priority <span class="op">=</span> <span class="fl">1</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; adding process: calculate_suitability</span></span>
<span><span class="co">#&gt; to species:</span></span>
<span><span class="co">#&gt; [1] "species_1" "species_2"</span></span>
<span><span class="co">#&gt; </span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="reproduction">Reproduction<a class="anchor" aria-label="anchor" href="#reproduction"></a>
</h3>
<p>As in the previous tutorials, we use a Ricker reproduction model to
calculate the new abundance of the species, but this time we let both
the carrying capacity and the reproduction rate depend on the niche
suitability of the environment.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim</span><span class="op">$</span><span class="fu">add_process</span><span class="op">(</span></span>
<span>    species <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"species_1"</span>, <span class="st">"species_2"</span><span class="op">)</span>,</span>
<span>    process_name <span class="op">=</span> <span class="st">"reproduction"</span>,</span>
<span>    process_fun <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">self</span><span class="op">$</span><span class="va">traits</span><span class="op">$</span><span class="va">abundance</span> <span class="op">&lt;-</span></span>
<span>            <span class="fu"><a href="../reference/ricker_reproduction_model.html">ricker_reproduction_model</a></span><span class="op">(</span></span>
<span>                <span class="va">self</span><span class="op">$</span><span class="va">traits</span><span class="op">$</span><span class="va">abundance</span>,</span>
<span>                <span class="va">self</span><span class="op">$</span><span class="va">traits</span><span class="op">$</span><span class="va">reproduction_rate</span> <span class="op">*</span> <span class="va">self</span><span class="op">$</span><span class="va">traits</span><span class="op">$</span><span class="va">climate_suitability</span>,</span>
<span>                <span class="va">self</span><span class="op">$</span><span class="va">traits</span><span class="op">$</span><span class="va">carrying_capacity</span> <span class="op">*</span> <span class="va">self</span><span class="op">$</span><span class="va">traits</span><span class="op">$</span><span class="va">climate_suitability</span></span>
<span>            <span class="op">)</span></span>
<span>    <span class="op">}</span>,</span>
<span>    execution_priority <span class="op">=</span> <span class="fl">2</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; adding process: reproduction</span></span>
<span><span class="co">#&gt; to species:</span></span>
<span><span class="co">#&gt; [1] "species_1" "species_2"</span></span>
<span><span class="co">#&gt; </span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="results">Results<a class="anchor" aria-label="anchor" href="#results"></a>
</h2>
<p>Now, we can execute the simulation and compare the results.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/set_verbosity.html">set_verbosity</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">sim</span><span class="op">$</span><span class="fu">begin</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Starting simualtion.</span></span>
<span><span class="co">#&gt; start of time step: 1</span></span>
<span><span class="co">#&gt; end of time step: 1</span></span>
<span><span class="co">#&gt; 0.13 secs remaining (estimate)</span></span>
<span><span class="co">#&gt; 10 % done</span></span>
<span><span class="co">#&gt; start of time step: 2</span></span>
<span><span class="co">#&gt; end of time step: 2</span></span>
<span><span class="co">#&gt; 0.23 secs remaining (estimate)</span></span>
<span><span class="co">#&gt; 20 % done</span></span>
<span><span class="co">#&gt; start of time step: 3</span></span>
<span><span class="co">#&gt; end of time step: 3</span></span>
<span><span class="co">#&gt; 0.08 secs remaining (estimate)</span></span>
<span><span class="co">#&gt; 30 % done</span></span>
<span><span class="co">#&gt; start of time step: 4</span></span>
<span><span class="co">#&gt; end of time step: 4</span></span>
<span><span class="co">#&gt; 0.072 secs remaining (estimate)</span></span>
<span><span class="co">#&gt; 40 % done</span></span>
<span><span class="co">#&gt; start of time step: 5</span></span>
<span><span class="co">#&gt; end of time step: 5</span></span>
<span><span class="co">#&gt; 0.058 secs remaining (estimate)</span></span>
<span><span class="co">#&gt; 50 % done</span></span>
<span><span class="co">#&gt; start of time step: 6</span></span>
<span><span class="co">#&gt; end of time step: 6</span></span>
<span><span class="co">#&gt; 0.049 secs remaining (estimate)</span></span>
<span><span class="co">#&gt; 60 % done</span></span>
<span><span class="co">#&gt; start of time step: 7</span></span>
<span><span class="co">#&gt; end of time step: 7</span></span>
<span><span class="co">#&gt; 0.035 secs remaining (estimate)</span></span>
<span><span class="co">#&gt; 70 % done</span></span>
<span><span class="co">#&gt; start of time step: 8</span></span>
<span><span class="co">#&gt; end of time step: 8</span></span>
<span><span class="co">#&gt; 0.023 secs remaining (estimate)</span></span>
<span><span class="co">#&gt; 80 % done</span></span>
<span><span class="co">#&gt; start of time step: 9</span></span>
<span><span class="co">#&gt; end of time step: 9</span></span>
<span><span class="co">#&gt; 0.011 secs remaining (estimate)</span></span>
<span><span class="co">#&gt; 90 % done</span></span>
<span><span class="co">#&gt; start of time step: 10</span></span>
<span><span class="co">#&gt; end of time step: 10</span></span>
<span><span class="co">#&gt; 0 secs remaining (estimate)</span></span>
<span><span class="co">#&gt; 100 % done</span></span>
<span><span class="co">#&gt; Simulation: 'example_simulation' finished</span></span>
<span><span class="co">#&gt; Exiting the Simulation</span></span>
<span><span class="co">#&gt; Runtime: 0.15 secs</span></span></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># define a nice color palette</span></span>
<span><span class="va">plot_cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html" class="external-link">hcl.colors</a></span><span class="op">(</span><span class="fl">100</span>, <span class="st">"Purple-Yellow"</span>, rev <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span></span>
<span>    <span class="va">sim</span>,</span>
<span>    obj <span class="op">=</span> <span class="st">"species_1"</span>,</span>
<span>    name <span class="op">=</span> <span class="st">"abundance"</span>,</span>
<span>    main <span class="op">=</span> <span class="st">"Species 1: abundance"</span>,</span>
<span>    col <span class="op">=</span> <span class="va">plot_cols</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="A03_niche_suitability_files/figure-html/resA-1.png" alt="Figure 6: The resulting abundance distribution of species 1 after 10 simulation time steps." width="700"><p class="caption">
Figure 6: The resulting abundance distribution of species 1 after 10
simulation time steps.
</p>
</div>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span></span>
<span>    <span class="va">sim</span><span class="op">$</span><span class="va">species_2</span>,</span>
<span>    trait <span class="op">=</span> <span class="st">"abundance"</span>,</span>
<span>    main <span class="op">=</span> <span class="st">"Species 2: abundance"</span>,</span>
<span>    col <span class="op">=</span> <span class="va">plot_cols</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="A03_niche_suitability_files/figure-html/resB-1.png" alt="Figure 7: The resulting abundance distribution of species 2 after 10 simulation time steps." width="700"><p class="caption">
Figure 7: The resulting abundance distribution of species 2 after 10
simulation time steps.
</p>
</div>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<ol style="list-style-type: decimal">
<li><p>Yin, X., Kropff, M.J., McLaren, G., Visperas, R.M., (1995) A
nonlinear model for crop development as a function of temperature,
Agricultural and Forest Meteorology, Volume 77, Issues 1-2, Pages 1–16,
<a href="doi:10.1016/0168-1923(95)02236-Q" class="uri">doi:10.1016/0168-1923(95)02236-Q</a></p></li>
<li><p>Yan, W., Hunt, L.A. (1999) An Equation for Modelling the
Temperature Response of Plants using only the Cardinal Temperatures,
Annals of Botany, Volume 84, Issue 5, Pages 607–614, ISSN 0305-7364, <a href="doi:10.1006/anbo.1999.0955" class="uri">doi:10.1006/anbo.1999.0955</a></p></li>
</ol>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Stefan Fallert, Lea Li, Juliano Sarmento Cabral, Bavarian Ministry of Science and Arts (bayklif), Deutsche Bundesstiftung Umwelt (DBU).</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
