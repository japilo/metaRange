<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="metaRange">
<title>08: Advanced options • metaRange</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="08: Advanced options">
<meta property="og:description" content="metaRange">
<meta property="og:image" content="https://metaRange.github.io/metaRange/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">metaRange</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/A01_intro.html">01: Introduction to metaRange</a>
    <a class="dropdown-item" href="../articles/A02_multiple_species.html">02: Multiple species</a>
    <a class="dropdown-item" href="../articles/A03_niche_suitability.html">03: Niche suitability</a>
    <a class="dropdown-item" href="../articles/A04_dispersal.html">04: Dispersal</a>
    <a class="dropdown-item" href="../articles/A05_species_interactions.html">05: Species interactions</a>
    <a class="dropdown-item" href="../articles/A06_metabolic_scaling.html">06: Metabolic scaling</a>
    <a class="dropdown-item" href="../articles/A07_age_structured_populations.html">07: Age structured populations</a>
    <a class="dropdown-item" href="../articles/A08_advanced_options.html">08: Advanced options</a>
    <a class="dropdown-item" href="../articles/A09_troubleshooting_and_caveats.html">09: Troubleshooting / caveats</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/metaRange/metaRange/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>08: Advanced options</h1>
                        <h4 data-toc-skip class="author">Fallert, S. and
Cabral, J.S.</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/metaRange/metaRange/blob/HEAD/vignettes/A08_advanced_options.Rmd" class="external-link"><code>vignettes/A08_advanced_options.Rmd</code></a></small>
      <div class="d-none name"><code>A08_advanced_options.Rmd</code></div>
    </div>

    
    
<p>More realistic and complicated simulations may require a more
advanced setup. This vignette will cover some of the more advanced
features of the <code>metaRange</code> package.</p>
<div class="section level2">
<h2 id="time-layer-mapping">Time layer mapping<a class="anchor" aria-label="anchor" href="#time-layer-mapping"></a>
</h2>
<p>The setup and processing of the environmental <code>SDS</code> can
take quite some time, especially when the environmental data is large.
In order to save the user time, the method
<code>set_time_layer_mapping()</code> allows the user to define a custom
mapping between the time steps and the layers of the environmental
raster. Use cases may be:</p>
<ol style="list-style-type: decimal">
<li>If the environment is static and does not undergo any change, the
user may want to use the same environmental raster layer for all time
steps.</li>
<li>Shortening or lengthening the number of time steps of the
simulation.</li>
<li>Using a “burn-in” period in the simulation, before the main
simulation begins. This is usually done to let the simulation state
reach a (semi) equilibrium state, from which the simulation objectives
can be studied.</li>
</ol>
<div class="section level3">
<h3 id="default-mapping">Default mapping<a class="anchor" aria-label="anchor" href="#default-mapping"></a>
</h3>
<p>The default configuration is that each layer in the environment
represents one time step of the simulation. I.e:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://metaRange.github.io/metaRange/">metaRange</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; metaRange version: 1.0.1</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/" class="external-link">terra</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; terra 1.7.55</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">raster_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"ex/elev.tif"</span>, package <span class="op">=</span> <span class="st">"terra"</span><span class="op">)</span></span>
<span><span class="va">r</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="va">raster_file</span><span class="op">)</span></span>
<span><span class="va">temperature</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="va">r</span>, center <span class="op">=</span> <span class="cn">FALSE</span>, scale <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">*</span> <span class="fl">10</span> <span class="op">+</span> <span class="fl">273.15</span></span>
<span><span class="va">precipitation</span> <span class="op">&lt;-</span> <span class="va">r</span> <span class="op">*</span> <span class="fl">2</span></span>
<span><span class="va">temperature</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">temperature</span>, <span class="fl">10</span><span class="op">)</span></span>
<span><span class="va">precipitation</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">precipitation</span>, <span class="fl">10</span><span class="op">)</span></span>
<span><span class="va">landscape</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/sds.html" class="external-link">sds</a></span><span class="op">(</span><span class="va">temperature</span>, <span class="va">precipitation</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">landscape</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"temperature"</span>, <span class="st">"precipitation"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_simulation.html">create_simulation</a></span><span class="op">(</span><span class="va">landscape</span><span class="op">)</span></span>
<span><span class="va">sim</span><span class="op">$</span><span class="va">number_time_steps</span></span>
<span><span class="co">#&gt; [1] 10</span></span>
<span><span class="va">sim</span><span class="op">$</span><span class="va">time_step_layer</span></span>
<span><span class="co">#&gt;  [1]  1  2  3  4  5  6  7  8  9 10</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="static-environment">Static environment<a class="anchor" aria-label="anchor" href="#static-environment"></a>
</h3>
<p>To use the same environmental raster (i.e. the first one) for all
time steps, one can use:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim</span><span class="op">$</span><span class="fu">set_time_layer_mapping</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep_len</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">sim</span><span class="op">$</span><span class="va">number_time_steps</span></span>
<span><span class="co">#&gt; [1] 10</span></span>
<span><span class="va">sim</span><span class="op">$</span><span class="va">time_step_layer</span></span>
<span><span class="co">#&gt;  [1] 1 1 1 1 1 1 1 1 1 1</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="changing-the-number-of-time-steps">Changing the number of time steps<a class="anchor" aria-label="anchor" href="#changing-the-number-of-time-steps"></a>
</h3>
<p>In the same way described above, one can also pick the specific layer
that are used and shorten the simulation length.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim</span><span class="op">$</span><span class="fu">set_time_layer_mapping</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">4</span>, <span class="fl">6</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">sim</span><span class="op">$</span><span class="va">number_time_steps</span></span>
<span><span class="co">#&gt; [1] 3</span></span>
<span><span class="va">sim</span><span class="op">$</span><span class="va">time_step_layer</span></span>
<span><span class="co">#&gt; [1] 2 4 6</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="burn-in-period">Burn-in period<a class="anchor" aria-label="anchor" href="#burn-in-period"></a>
</h3>
<p>To add a burn-in period of 10 time steps, where the environmental
data is not updated, one could use the function as follows:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim</span><span class="op">$</span><span class="fu">set_time_layer_mapping</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep_len</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">10</span><span class="op">)</span>, <span class="fl">2</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">sim</span><span class="op">$</span><span class="va">number_time_steps</span></span>
<span><span class="co">#&gt; [1] 19</span></span>
<span><span class="va">sim</span><span class="op">$</span><span class="va">time_step_layer</span></span>
<span><span class="co">#&gt;  [1]  1  1  1  1  1  1  1  1  1  1  2  3  4  5  6  7  8  9 10</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="global-variables-and-processes">Global variables and processes<a class="anchor" aria-label="anchor" href="#global-variables-and-processes"></a>
</h2>
<p><code>metaRange</code> uses an object orient programming paradigm,
this means each species is described by its own biologically relevant
processes and traits. However, there may be cases where the user wants
to define a global variable or process that is shared between all
species, be it to store intermediate results that don’t belong to one
species or processes to visualize or store output. This can by done by
using the <code>add_globals()</code> function for adding global
variables and the <code>add_process()</code> function with no
<code>species</code> argument specified, for adding global processes.
The global variables and processes are accessible through in the
<code>globals</code>and <code>processes</code> field of the simulation
object itself, respectively. The benefit of using a global process is
that the <code>self</code> keyword refers to the simulation object
itself, which allows for easier indexing across multiple species.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim</span><span class="op">$</span><span class="fu">add_species</span><span class="op">(</span><span class="st">"species_one"</span><span class="op">)</span></span>
<span><span class="va">sim</span><span class="op">$</span><span class="fu">add_species</span><span class="op">(</span><span class="st">"species_two"</span><span class="op">)</span></span>
<span><span class="va">sim</span><span class="op">$</span><span class="fu">add_globals</span><span class="op">(</span></span>
<span>    mean_abundance_over_time <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        <span class="st">"species_one"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        <span class="st">"species_two"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>    <span class="co"># ... more global variables</span></span>
<span><span class="op">)</span></span>
<span><span class="va">sim</span><span class="op">$</span><span class="va">globals</span><span class="op">$</span><span class="va">global_var</span></span>
<span><span class="co">#&gt; NULL</span></span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim</span><span class="op">$</span><span class="fu">add_process</span><span class="op">(</span></span>
<span>    <span class="co"># Note the missing species argument</span></span>
<span>    process_name <span class="op">=</span> <span class="st">"global_process"</span>,</span>
<span>    process_fun <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="co"># self = simulation object</span></span>
<span>        <span class="co"># easy access to simulation functions</span></span>
<span>        <span class="kw">for</span> <span class="op">(</span><span class="va">sp</span> <span class="kw">in</span> <span class="va">self</span><span class="op">$</span><span class="fu">species_names</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>            <span class="va">self</span><span class="op">$</span><span class="va">globals</span><span class="op">$</span><span class="va">mean_abundance_over_time</span><span class="op">[[</span><span class="va">sp</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span></span>
<span>                <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>                    <span class="va">self</span><span class="op">$</span><span class="va">globals</span><span class="op">$</span><span class="va">mean_abundance_over_time</span><span class="op">[[</span><span class="va">sp</span><span class="op">]</span><span class="op">]</span>,</span>
<span>                    <span class="fu"><a href="https://rdrr.io/pkg/terra/man/summarize-generics.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">self</span><span class="op">[[</span><span class="va">sp</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">traits</span><span class="op">$</span><span class="va">abundance</span><span class="op">)</span></span>
<span>                <span class="op">)</span></span>
<span>        <span class="op">}</span></span>
<span>    <span class="op">}</span>,</span>
<span>    execution_priority <span class="op">=</span> <span class="fl">1</span></span>
<span><span class="op">)</span></span>
<span><span class="va">sim</span><span class="op">$</span><span class="va">processes</span><span class="op">$</span><span class="va">global_process</span></span>
<span><span class="co">#&gt; Process name:  global_process </span></span>
<span><span class="co">#&gt; PID:  PID-147a3ef391-global_process </span></span>
<span><span class="co">#&gt; execution_priority:  1 </span></span>
<span><span class="co">#&gt; execution_environment_label:  simulation_3f8e1964 </span></span>
<span><span class="co">#&gt; $fun: function() {</span></span>
<span><span class="co">#&gt;         # self = simulation object</span></span>
<span><span class="co">#&gt;         # easy access to simulation functions</span></span>
<span><span class="co">#&gt;         for (sp in self$species_names()) {</span></span>
<span><span class="co">#&gt;             self$globals$mean_abundance_over_time[[sp]] &lt;-</span></span>
<span><span class="co">#&gt;                 c(</span></span>
<span><span class="co">#&gt;                     self$globals$mean_abundance_over_time[[sp]],</span></span>
<span><span class="co">#&gt;                     mean(self[[sp]]$traits$abundance)</span></span>
<span><span class="co">#&gt;                 )</span></span>
<span><span class="co">#&gt;         }</span></span>
<span><span class="co">#&gt;     }</span></span>
<span><span class="co">#&gt; &lt;environment: 0x0000024a91fa1298&gt;</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="interaction-with-the-priority-queue">Interaction with the priority queue<a class="anchor" aria-label="anchor" href="#interaction-with-the-priority-queue"></a>
</h2>
<p>With some specific study questions, it may not be desired to simulate
all species from the first time step. As an example, during the
simulation of invasion dynamics, one may want to have a burn-in period
without the invasive species present and then introduce it after this
point. On the other hand, there may be a need to simulate a species for
a specific time period and then remove it from the simulation
(e.g. there is no point in calculating the reproduction of a species
that has gone extinct). To accommodate this, <code>metaRange</code>
allows the user to manually add and remove processes from the priority
queue during the simulation.</p>
<div class="section level3">
<h3 id="queuing-a-process">Queuing a process<a class="anchor" aria-label="anchor" href="#queuing-a-process"></a>
</h3>
<p>The default behavior of <code>add_process()</code> is to immediately
add the process to the priority queue. Setting the argument
<code>queue = FALSE</code> will add the process to the simulation, but
not to the priority queue. In that case, the user has at any point
during the simulation the option to add the process to the priority
queue using the <code>enqueue()</code> method of the priority queue.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_simulation.html">create_simulation</a></span><span class="op">(</span><span class="va">landscape</span><span class="op">)</span></span>
<span><span class="va">sim</span><span class="op">$</span><span class="fu">set_time_layer_mapping</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">sim</span><span class="op">$</span><span class="fu">add_species</span><span class="op">(</span>name <span class="op">=</span> <span class="st">"species_1"</span><span class="op">)</span></span>
<span><span class="va">sim</span><span class="op">$</span><span class="fu">add_process</span><span class="op">(</span></span>
<span>    species <span class="op">=</span> <span class="st">"species_1"</span>,</span>
<span>    process_name <span class="op">=</span> <span class="st">"invasion"</span>,</span>
<span>    process_fun <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"Species invades!"</span><span class="op">)</span></span>
<span>    <span class="op">}</span>,</span>
<span>    execution_priority <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    <span class="co"># Note the queue = FALSE argument</span></span>
<span>    queue <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span><span class="va">sim</span><span class="op">$</span><span class="fu">add_process</span><span class="op">(</span></span>
<span>    process_name <span class="op">=</span> <span class="st">"activate_species_1"</span>,</span>
<span>    process_fun <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"time step: "</span>, <span class="va">self</span><span class="op">$</span><span class="fu">get_current_time_step</span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>        <span class="co"># Note that when manually changing the queue,</span></span>
<span>        <span class="co"># the changes will take place in the</span></span>
<span>        <span class="co"># _next_ time step</span></span>
<span>        <span class="co"># e.g. the following will lead to the process</span></span>
<span>        <span class="co"># being first executed in time step 4)</span></span>
<span>        <span class="kw">if</span> <span class="op">(</span><span class="va">self</span><span class="op">$</span><span class="fu">get_current_time_step</span><span class="op">(</span><span class="op">)</span> <span class="op">==</span> <span class="fl">3</span><span class="op">)</span> <span class="op">{</span></span>
<span>            <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"Activating species 1"</span><span class="op">)</span></span>
<span>            <span class="kw">for</span> <span class="op">(</span><span class="va">pr</span> <span class="kw">in</span> <span class="va">self</span><span class="op">$</span><span class="va">species_1</span><span class="op">$</span><span class="va">processes</span><span class="op">)</span> <span class="op">{</span></span>
<span>                <span class="va">self</span><span class="op">$</span><span class="va">queue</span><span class="op">$</span><span class="fu">enqueue</span><span class="op">(</span><span class="va">pr</span><span class="op">)</span></span>
<span>            <span class="op">}</span></span>
<span>        <span class="op">}</span></span>
<span>    <span class="op">}</span>,</span>
<span>    execution_priority <span class="op">=</span> <span class="fl">1</span></span>
<span><span class="op">)</span></span>
<span><span class="va">sim</span><span class="op">$</span><span class="fu">begin</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; time step: 1</span></span>
<span><span class="co">#&gt; time step: 2</span></span>
<span><span class="co">#&gt; time step: 3</span></span>
<span><span class="co">#&gt; Activating species 1</span></span>
<span><span class="co">#&gt; time step: 4</span></span>
<span><span class="co">#&gt; Species invades!</span></span>
<span><span class="co">#&gt; time step: 5</span></span>
<span><span class="co">#&gt; Species invades!</span></span>
<span><span class="co">#&gt; time step: 6</span></span>
<span><span class="co">#&gt; Species invades!</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="dequeue-a-process">Dequeue a process<a class="anchor" aria-label="anchor" href="#dequeue-a-process"></a>
</h3>
<p>The <code>dequeue()</code> function of the priority queue allows the
user to remove a process from the priority queue.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_simulation.html">create_simulation</a></span><span class="op">(</span><span class="va">landscape</span><span class="op">)</span></span>
<span><span class="va">sim</span><span class="op">$</span><span class="fu">set_time_layer_mapping</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">sim</span><span class="op">$</span><span class="fu">add_species</span><span class="op">(</span>name <span class="op">=</span> <span class="st">"species_1"</span><span class="op">)</span></span>
<span><span class="va">sim</span><span class="op">$</span><span class="fu">add_process</span><span class="op">(</span></span>
<span>    species <span class="op">=</span> <span class="st">"species_1"</span>,</span>
<span>    process_name <span class="op">=</span> <span class="st">"invasion"</span>,</span>
<span>    process_fun <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"Species invades!"</span><span class="op">)</span></span>
<span>    <span class="op">}</span>,</span>
<span>    execution_priority <span class="op">=</span> <span class="fl">1</span>,</span>
<span><span class="op">)</span></span>
<span><span class="va">sim</span><span class="op">$</span><span class="fu">add_process</span><span class="op">(</span></span>
<span>    process_name <span class="op">=</span> <span class="st">"stop_invasion"</span>,</span>
<span>    process_fun <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"time step: "</span>, <span class="va">self</span><span class="op">$</span><span class="fu">get_current_time_step</span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>        <span class="kw">if</span> <span class="op">(</span><span class="va">self</span><span class="op">$</span><span class="fu">get_current_time_step</span><span class="op">(</span><span class="op">)</span> <span class="op">==</span> <span class="fl">3</span><span class="op">)</span> <span class="op">{</span></span>
<span>            <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"Extiction species 1"</span><span class="op">)</span></span>
<span>            <span class="kw">for</span> <span class="op">(</span><span class="va">pr</span> <span class="kw">in</span> <span class="va">self</span><span class="op">$</span><span class="va">species_1</span><span class="op">$</span><span class="va">processes</span><span class="op">)</span> <span class="op">{</span></span>
<span>                <span class="co"># Here we are querying the process ID,</span></span>
<span>                <span class="co"># which is a unique identifier for each process</span></span>
<span>                <span class="co"># so that the priority queue knows what to remove</span></span>
<span>                <span class="va">self</span><span class="op">$</span><span class="va">queue</span><span class="op">$</span><span class="fu">dequeue</span><span class="op">(</span><span class="va">pr</span><span class="op">$</span><span class="fu">get_PID</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span>            <span class="op">}</span></span>
<span>        <span class="op">}</span></span>
<span>    <span class="op">}</span>,</span>
<span>    execution_priority <span class="op">=</span> <span class="fl">1</span></span>
<span><span class="op">)</span></span>
<span><span class="va">sim</span><span class="op">$</span><span class="fu">begin</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Species invades!</span></span>
<span><span class="co">#&gt; time step: 1</span></span>
<span><span class="co">#&gt; Species invades!</span></span>
<span><span class="co">#&gt; time step: 2</span></span>
<span><span class="co">#&gt; Species invades!</span></span>
<span><span class="co">#&gt; time step: 3</span></span>
<span><span class="co">#&gt; Extiction species 1</span></span>
<span><span class="co">#&gt; time step: 4</span></span>
<span><span class="co">#&gt; time step: 5</span></span>
<span><span class="co">#&gt; time step: 6</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="ending-the-simulation-early">Ending the simulation early<a class="anchor" aria-label="anchor" href="#ending-the-simulation-early"></a>
</h2>
<p>To end the simulation safely, before the last time step, the user can
use the <code>exit()</code> method of the simulation. This will end the
simulation at the end of the process it is called inside of. A possible
use case would be to conditionally end the simulation if all species are
extinct.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_simulation.html">create_simulation</a></span><span class="op">(</span><span class="va">landscape</span><span class="op">)</span></span>
<span><span class="va">sim</span><span class="op">$</span><span class="fu">set_time_layer_mapping</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">sim</span><span class="op">$</span><span class="fu">add_species</span><span class="op">(</span>name <span class="op">=</span> <span class="st">"species_1"</span><span class="op">)</span></span>
<span><span class="va">sim</span><span class="op">$</span><span class="fu">add_process</span><span class="op">(</span></span>
<span>    species <span class="op">=</span> <span class="st">"species_1"</span>,</span>
<span>    process_name <span class="op">=</span> <span class="st">"invasion"</span>,</span>
<span>    process_fun <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"Species invades!"</span><span class="op">)</span></span>
<span>    <span class="op">}</span>,</span>
<span>    execution_priority <span class="op">=</span> <span class="fl">1</span>,</span>
<span><span class="op">)</span></span>
<span><span class="va">sim</span><span class="op">$</span><span class="fu">add_process</span><span class="op">(</span></span>
<span>    process_name <span class="op">=</span> <span class="st">"end_simualtion"</span>,</span>
<span>    process_fun <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"time step: "</span>, <span class="va">self</span><span class="op">$</span><span class="fu">get_current_time_step</span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>        <span class="kw">if</span> <span class="op">(</span><span class="va">self</span><span class="op">$</span><span class="fu">get_current_time_step</span><span class="op">(</span><span class="op">)</span> <span class="op">==</span> <span class="fl">4</span><span class="op">)</span> <span class="op">{</span></span>
<span>            <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"Ending simulation early"</span><span class="op">)</span></span>
<span>            <span class="va">self</span><span class="op">$</span><span class="fu">exit</span><span class="op">(</span><span class="op">)</span></span>
<span>        <span class="op">}</span></span>
<span>    <span class="op">}</span>,</span>
<span>    execution_priority <span class="op">=</span> <span class="fl">1</span></span>
<span><span class="op">)</span></span>
<span><span class="va">sim</span><span class="op">$</span><span class="fu">begin</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Species invades!</span></span>
<span><span class="co">#&gt; time step: 1</span></span>
<span><span class="co">#&gt; Species invades!</span></span>
<span><span class="co">#&gt; time step: 2</span></span>
<span><span class="co">#&gt; Species invades!</span></span>
<span><span class="co">#&gt; time step: 3</span></span>
<span><span class="co">#&gt; Species invades!</span></span>
<span><span class="co">#&gt; time step: 4</span></span>
<span><span class="co">#&gt; Ending simulation early</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Stefan Fallert, Lea Li, Juliano Sarmento Cabral, Bavarian Ministry of Science and Arts (bayklif), Deutsche Bundesstiftung Umwelt (DBU).</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
