<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="metaRange">
<title>01: Introduction to metaRange • metaRange</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="01: Introduction to metaRange">
<meta property="og:description" content="metaRange">
<meta property="og:image" content="https://metaRange.github.io/metaRange/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">metaRange</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/A01_intro.html">01: Introduction to metaRange</a>
    <a class="dropdown-item" href="../articles/A02_multiple_species.html">02: Multiple species</a>
    <a class="dropdown-item" href="../articles/A03_niche_suitability.html">03: Niche suitability</a>
    <a class="dropdown-item" href="../articles/A04_dispersal.html">04: Dispersal</a>
    <a class="dropdown-item" href="../articles/A05_species_interactions.html">05: Species interactions</a>
    <a class="dropdown-item" href="../articles/A06_metabolic_scaling.html">06: Metabolic scaling</a>
    <a class="dropdown-item" href="../articles/A07_age_structured_populations.html">07: Age structured populations</a>
    <a class="dropdown-item" href="../articles/A08_advanced_options.html">08: Advanced options</a>
    <a class="dropdown-item" href="../articles/A09_troubleshooting_and_caveats.html">09: Troubleshooting / caveats</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/metaRange/metaRange/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>01: Introduction to metaRange</h1>
                        <h4 data-toc-skip class="author">Fallert, S. and
Cabral, J.S.</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/metaRange/metaRange/blob/HEAD/vignettes/A01_intro.Rmd" class="external-link"><code>vignettes/A01_intro.Rmd</code></a></small>
      <div class="d-none name"><code>A01_intro.Rmd</code></div>
    </div>

    
    
<p><strong><code>metaRange</code></strong> is a framework to build a
variety of different process based species distribution models that can
include a (basically) arbitrary number of environmental factors,
processes, species and species interactions. The common denominator for
all models build with metaRange is that they are raster and population
based.</p>
<p>Each metaRange <code>simulation</code> object contains one
<code>environment</code> that holds and manages all the environmental
factors that may influence the simulation (as raster data) and one or
more <code>species</code> that are simulated in the environment.</p>
<p>Each species object has two main characteristics: <code>traits</code>
and <code>processes</code>. Species <code>traits</code> can be (somewhat
arbitrary) pieces of data that describe and store information about the
species while <code>processes</code> are functions that describe how the
species interacts with itself, time, climate and other species. During
each time step of the simulation, the processes of the species are
executed in a user defined order and can access and modify the species
traits.</p>
<p>While the models built with metaRange can be quite variable in their
structure, they are all based on population dynamics. This means that in
most cases a <code>trait</code> will not be a single number but a matrix
that has the same size as the raster data in the environment, where each
value represents the trait value for one population in the corresponding
grid cell of the of the environment. Based on this, most
<code>processes</code> will describe population (and meta population)
dynamics and not individual based mechanisms. Figure 1 shows an example
of some of the different environmental factors, species traits and
processes that could be included in a simulation.</p>
<div class="figure">
<img src="../reference/figures/example_simulation.svg" alt="Figure 1: Example of some of the different environmental factors, species traits and processes that could be included in a simulation." width="100%"><p class="caption">
Figure 1: Example of some of the different environmental factors,
species traits and processes that could be included in a simulation.
</p>
</div>
A more technical overview of the different components of a simulation
and how they interact with each other is shown in Figure 2. While the
environment has a temporal dimension (i.e. the different time steps, see
Fig.1), the traits (or the global variables of the simulation) have no
temporal property. They represent the state of the species (or of the
simulation respectively) in one (the current) time step. When a process
is executed within a time step, it can access this current state of the
simulation and modify it, which results in changing traits over the
course of the simulation. Each process can be assigned a priority, that
is used by the <code>process priority queue</code> to determine in which
order the processes are executed within one time step.
<div class="figure">
<img src="../reference/figures/simulation_high_level_overview.svg" alt="Figure 2: Overview of the different components of a simulation and how they interact with each other. Note that the number of species as well as the number of traits and processes per species is not limited, but only a selection is shown for simplicity." width="100%"><p class="caption">
Figure 2: Overview of the different components of a simulation and how
they interact with each other. Note that the number of species as well
as the number of traits and processes per species is not limited, but
only a selection is shown for simplicity.
</p>
</div>
<div class="section level2">
<h2 id="setting-up-a-simulation">Setting up a simulation<a class="anchor" aria-label="anchor" href="#setting-up-a-simulation"></a>
</h2>
<p>Following is a very simple example of how to set up a simulation with
<code>metaRange</code>. In this example we only use a single species and
one environmental factor (habitat quality). At the end of this
introduction we will see how the abundance of the species changes in
relation to the quality of the habitat each population occupies.</p>
<p>To start, we need to load the package and its dependencies.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://metaRange.github.io/metaRange/">metaRange</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; metaRange version: 1.0.0</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/" class="external-link">terra</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; terra 1.7.55</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="loading-the-landscape">Loading the landscape<a class="anchor" aria-label="anchor" href="#loading-the-landscape"></a>
</h2>
<p>The first step when setting up a simulation is the loading of the
environment in which the simulation will take place. This can either be
real world data or “theoretical” / generated data and may include for
example different climate variables, land cover or elevation.</p>
<p>The simulation expects this data as an <code>SpatRasterDataset</code>
(<code>SDS</code>) which is a collection of different raster files that
all share the same extent and resolution. Each sub-dataset in this SDS
represents one environmental variable and each layer represents one time
step of the simulation. In other words, metaRange does not simulate the
environmental conditions itself, but expects the user to provide the
environmental data for each time step.</p>
<p>To create such a dataset one can use the function
<code><a href="https://rdrr.io/pkg/terra/man/sds.html" class="external-link">terra::sds()</a></code>. One important note: Since the layer represent
the condition in one time step, all the raster files that go into the
<code>SDS</code> need to have the same number of layers (i.e. the
desired number of time steps the simulation should have). After the
<code>SDS</code> is created, the individual subdatasets should be named,
since this is how the simulation will refer to them.</p>
<p>To simplify this introduction, we use an example landscape consisting
only of habitat quality data, with 10 time steps (layers) that are all
the same (i.e. no environmental change). Luckily the <code>terra</code>
package has a built-in demo that we can use for this purpose.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># find the file</span></span>
<span><span class="va">raster_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"ex/elev.tif"</span>, package <span class="op">=</span> <span class="st">"terra"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># load it</span></span>
<span><span class="va">r</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="va">raster_file</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># scale it</span></span>
<span><span class="va">r</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="va">r</span>, center <span class="op">=</span> <span class="cn">FALSE</span>, scale <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">r</span>, main <span class="op">=</span> <span class="st">"Habitat quality"</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="A01_intro_files/figure-html/create_landscape-1.png" alt="Figure 3: The habitat quality of the example landscape. Note: higher value = better habitat quality" width="700"><p class="caption">
Figure 3: The habitat quality of the example landscape. Note: higher
value = better habitat quality
</p>
</div>
<p>Now we can turn this raster with one layer into an <code>SDS</code>
that has multiple layer (one for each time step).</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">r</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">r</span>, <span class="fl">10</span><span class="op">)</span></span>
<span><span class="va">landscape</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/sds.html" class="external-link">sds</a></span><span class="op">(</span><span class="va">r</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">landscape</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"habitat_quality"</span><span class="op">)</span></span>
<span><span class="va">landscape</span></span>
<span><span class="co">#&gt; class       : SpatRasterDataset </span></span>
<span><span class="co">#&gt; subdatasets : 1 </span></span>
<span><span class="co">#&gt; dimensions  : 90, 95 (nrow, ncol)</span></span>
<span><span class="co">#&gt; nlyr        : 10 </span></span>
<span><span class="co">#&gt; resolution  : 0.008333333, 0.008333333  (x, y)</span></span>
<span><span class="co">#&gt; extent      : 5.741667, 6.533333, 49.44167, 50.19167  (xmin, xmax, ymin, ymax)</span></span>
<span><span class="co">#&gt; coord. ref. : lon/lat WGS 84 (EPSG:4326) </span></span>
<span><span class="co">#&gt; source(s)   : memory </span></span>
<span><span class="co">#&gt; names       : habitat_quality</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="pre-setup">Pre-setup<a class="anchor" aria-label="anchor" href="#pre-setup"></a>
</h2>
<p>Before creating the simulation, it may be helpful to enable extensive
reporting, which will print out a lot of information each time a
metaRange function is called. This can be enabled or disabled at any
time (i.e. also while the simulation is running), but in order to
highlight what each function call in this tutorial does, we enable it at
the beginning of the setup.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 0 = no reporting</span></span>
<span><span class="co"># 1 = a bit of info</span></span>
<span><span class="co"># 2 = very verbose</span></span>
<span><span class="fu"><a href="../reference/set_verbosity.html">set_verbosity</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="creating-the-simulation">Creating the simulation<a class="anchor" aria-label="anchor" href="#creating-the-simulation"></a>
</h2>
<p>After the landscape is loaded, the simulation can be created using
the <code><a href="../reference/create_simulation.html">create_simulation()</a></code> function. The only required
argument is <code>source_environment</code> which is the landscape /
environment <code>SDS</code> that was created in the first step. One can
optionally specify an ID for the simulation and a seed for the random
number generator.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_simulation.html">create_simulation</a></span><span class="op">(</span></span>
<span>    source_environment <span class="op">=</span> <span class="va">landscape</span>,</span>
<span>    ID <span class="op">=</span> <span class="st">"example_simulation"</span>,</span>
<span>    seed <span class="op">=</span> <span class="fl">1</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; number of time steps: 10</span></span>
<span><span class="co">#&gt; time step layer mapping: 1, 2, 3, 4, 5, 6, 7, 8, 9, 10</span></span>
<span><span class="co">#&gt; added environment</span></span>
<span><span class="co">#&gt; class       : SpatRasterDataset </span></span>
<span><span class="co">#&gt; subdatasets : 1 </span></span>
<span><span class="co">#&gt; dimensions  : 90, 95 (nrow, ncol)</span></span>
<span><span class="co">#&gt; nlyr        : 10 </span></span>
<span><span class="co">#&gt; resolution  : 0.008333333, 0.008333333  (x, y)</span></span>
<span><span class="co">#&gt; extent      : 5.741667, 6.533333, 49.44167, 50.19167  (xmin, xmax, ymin, ymax)</span></span>
<span><span class="co">#&gt; coord. ref. : lon/lat WGS 84 (EPSG:4326) </span></span>
<span><span class="co">#&gt; source(s)   : memory </span></span>
<span><span class="co">#&gt; names       : habitat_quality</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; created simulation: example_simulation</span></span></code></pre></div>
<p>If you want to inspect the simulation object, you can either print
it, to lists its fields and methods or use the <code><a href="https://rdrr.io/pkg/terra/man/summary.html" class="external-link">summary()</a></code>
function to get an overview of the simulation state.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim</span></span>
<span><span class="co">#&gt; metaRangeSimulation object</span></span>
<span><span class="co">#&gt; Fields: </span></span>
<span><span class="co">#&gt;   $ID</span></span>
<span><span class="co">#&gt;   $globals</span></span>
<span><span class="co">#&gt;   $environment</span></span>
<span><span class="co">#&gt;   $number_time_steps</span></span>
<span><span class="co">#&gt;   $time_step_layer</span></span>
<span><span class="co">#&gt;   $current_time_step</span></span>
<span><span class="co">#&gt;   $queue</span></span>
<span><span class="co">#&gt;   $processes</span></span>
<span><span class="co">#&gt;   $seed</span></span>
<span><span class="co">#&gt; Species: none</span></span>
<span><span class="co">#&gt; Methods: </span></span>
<span><span class="co">#&gt;   $species_names()</span></span>
<span><span class="co">#&gt;   $add_globals()</span></span>
<span><span class="co">#&gt;   $add_species()</span></span>
<span><span class="co">#&gt;   $add_traits()</span></span>
<span><span class="co">#&gt;   $add_process()</span></span>
<span><span class="co">#&gt;   $begin()</span></span>
<span><span class="co">#&gt;   $exit()</span></span>
<span><span class="co">#&gt;   $set_current_time_step()</span></span>
<span><span class="co">#&gt;   $set_time_layer_mapping()</span></span>
<span><span class="co">#&gt;   $print()</span></span>
<span><span class="co">#&gt;   $summary()</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">sim</span><span class="op">)</span></span>
<span><span class="co">#&gt; ID: example_simulation </span></span>
<span><span class="co">#&gt; Environment: </span></span>
<span><span class="co">#&gt; class       : SpatRasterDataset </span></span>
<span><span class="co">#&gt; subdatasets : 1 </span></span>
<span><span class="co">#&gt; dimensions  : 90, 95 (nrow, ncol)</span></span>
<span><span class="co">#&gt; nlyr        : 10 </span></span>
<span><span class="co">#&gt; resolution  : 0.008333333, 0.008333333  (x, y)</span></span>
<span><span class="co">#&gt; extent      : 5.741667, 6.533333, 49.44167, 50.19167  (xmin, xmax, ymin, ymax)</span></span>
<span><span class="co">#&gt; coord. ref. : lon/lat WGS 84 (EPSG:4326) </span></span>
<span><span class="co">#&gt; source(s)   : memory </span></span>
<span><span class="co">#&gt; names       : habitat_quality </span></span>
<span><span class="co">#&gt; Time step layer mapping:  1 2 3 4 5 6 7 8 9 10 </span></span>
<span><span class="co">#&gt; Current time step:  1 </span></span>
<span><span class="co">#&gt; Seed:  1 </span></span>
<span><span class="co">#&gt; Species:</span></span>
<span><span class="co">#&gt;   </span></span>
<span><span class="co">#&gt; Simulation level processes:</span></span>
<span><span class="co">#&gt; NULL</span></span>
<span><span class="co">#&gt; Gobal variables:</span></span>
<span><span class="co">#&gt; NULL</span></span>
<span><span class="co">#&gt; Queue:</span></span>
<span><span class="co">#&gt; At process:  0 out of:  0 </span></span>
<span><span class="co">#&gt; Remaining queue: </span></span>
<span><span class="co">#&gt; --- empty </span></span>
<span><span class="co">#&gt; Future (next time step) queue: </span></span>
<span><span class="co">#&gt; --- empty</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="adding-species-to-the-simulation">Adding species to the simulation<a class="anchor" aria-label="anchor" href="#adding-species-to-the-simulation"></a>
</h2>
<p>After the simulation is created, species can be added to it using the
<code>add_species()</code> function. At this point one has to switch to
the syntax of the <a href="https://r6.r-lib.org/articles/Introduction.html" class="external-link">R6</a> package,
that metaRange uses. This means that <code>add_species()</code> is a
method of the <code>simulation</code> object and can be called using the
<code>$</code> operator (i.e. by indexing the simulation object and
calling a function that is stored inside of it). The only required
argument is <code>name</code> which is the name of the species that will
be added.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim</span><span class="op">$</span><span class="fu">add_species</span><span class="op">(</span>name <span class="op">=</span> <span class="st">"species_1"</span><span class="op">)</span></span>
<span><span class="co">#&gt; adding species</span></span>
<span><span class="co">#&gt; Name: species_1</span></span></code></pre></div>
<p>This species can now be accessed by using the <code>$</code> operator
again.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim</span><span class="op">$</span><span class="va">species_1</span></span>
<span><span class="co">#&gt; Species:  species_1 </span></span>
<span><span class="co">#&gt; processes: </span></span>
<span><span class="co">#&gt; NULL</span></span>
<span><span class="co">#&gt; traits: </span></span>
<span><span class="co">#&gt; character(0)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="adding-traits-to-species">Adding traits to species<a class="anchor" aria-label="anchor" href="#adding-traits-to-species"></a>
</h2>
<p>After species are added to the simulation, traits can be assigned to
them using the <code>add_traits()</code> method. The first argument is
<code>species</code> which is a character vector of the species names to
which the trait should be assigned to. The second argument is
<code>population_level</code>, a <code>TRUE/FALSE</code> value, that
decides if the trait should be stored with one value per population
(i.e. as a matrix of the same size as the landscape) or not (i.e. only
one value per species). All following arguments can be supplied in the
form of <code>trait_name = trait_value</code>.</p>
<p>For now we only add three traits: <code>abundance</code> (number of
individuals in each population), <code>reproduction_rate</code> (how
fast the populations can reproduce) and <code>carrying_capacity</code>
(maximum number of individuals per grid cell). Traits always represent
the “current” state of a species. This means that the abundance we use
as input here represents the initial state of the simulation. Over the
course of the simulation (i.e. in each time step) the traits can be
updated and change. In this example, the abundance will change each time
step while e.g. the reproduction rate stays the same, but in other cases
each trait might change with time.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim</span><span class="op">$</span><span class="fu">add_traits</span><span class="op">(</span></span>
<span>    species <span class="op">=</span> <span class="st">"species_1"</span>,</span>
<span>    population_level <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    abundance <span class="op">=</span> <span class="fl">100</span>,</span>
<span>    reproduction_rate <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>    carrying_capacity <span class="op">=</span> <span class="fl">1000</span></span>
<span>    <span class="co"># ...</span></span>
<span>    <span class="co"># Note that here could be more traits, there is no limit</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; adding traits:</span></span>
<span><span class="co">#&gt; [1] "abundance"         "reproduction_rate" "carrying_capacity"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; to species:</span></span>
<span><span class="co">#&gt; [1] "species_1"</span></span>
<span><span class="co">#&gt; </span></span></code></pre></div>
<p>We can check what traits a species has by printing them:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim</span><span class="op">$</span><span class="va">species_1</span><span class="op">$</span><span class="va">traits</span></span>
<span><span class="co">#&gt; abundance :  num [1:90, 1:95] 100 100 100 100 100 100 100 100 100 100 ...</span></span>
<span><span class="co">#&gt; carrying_capacity :  num [1:90, 1:95] 1000 1000 1000 1000 1000 1000 1000 1000 1000 1000 ...</span></span>
<span><span class="co">#&gt; reproduction_rate :  num [1:90, 1:95] 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 ...</span></span></code></pre></div>
<p>Or plotting them:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">sim</span><span class="op">$</span><span class="va">species_1</span>, <span class="st">"abundance"</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="A01_intro_files/figure-html/unnamed-chunk-6-1.png" alt="Figure 4: The initial abundance of the species." width="700"><p class="caption">
Figure 4: The initial abundance of the species.
</p>
</div>
<p>Note that the above plot is not very interesting, since the abundance
is the same for each population at the beginning of the simulation.</p>
</div>
<div class="section level2">
<h2 id="adding-processes">Adding processes<a class="anchor" aria-label="anchor" href="#adding-processes"></a>
</h2>
<p>After the species and its traits are added, the processes that
describe the how the species interacts with its environment can be
added, using the <code>add_process()</code> method. The arguments are:
<code>species</code> which is a character vector of the species that
should get the process, <code>process_name</code> which is a human
readable name for the process and <code>process_fun</code> which is the
function that will be called when the process is executed.</p>
<p>One argument that might be confusing is the
<code>execution_priority</code>. This is a number that gives the process
a priority “weight” and decides in which order the processes are
executed within one time step. The smaller the number, the earlier the
process will be executed (e.g. 1 gets executed before 2). In the case
two (or more) processes have the same priority, it is assumed that they
are independent from each other and that their execution order does not
matter.</p>
<div class="section level3">
<h3 id="reproduction">Reproduction<a class="anchor" aria-label="anchor" href="#reproduction"></a>
</h3>
<p>In this example we will only add a single process
(<code>reproduction</code>) to the species, that is going to calculate
the abundance (for each population) in the next time step, depending on
the habitat quality. To do so, we can use a built in function
<code><a href="../reference/ricker_reproduction_model.html">ricker_reproduction_model()</a></code> that implements the “classic”
Ricker reproduction model (Ricker, W.E. (1954) compare also: Cabral,
J.S. and Schurr, F.M. (2010)) [Ref. 1 &amp; 2].</p>
<p>Note the use of the <code>self</code> keyword in the function. In
this context, <code>self</code> refers to the species that the process
is attached to. This means that the function can access the species
traits and modify them and also access the environment (each species
holds a reference to the simulation it was created in).</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim</span><span class="op">$</span><span class="fu">add_process</span><span class="op">(</span></span>
<span>    species <span class="op">=</span> <span class="st">"species_1"</span>,</span>
<span>    process_name <span class="op">=</span> <span class="st">"reproduction"</span>,</span>
<span>    process_fun <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="co"># use a ricker reproduction model</span></span>
<span>        <span class="co"># to calculate the new abundance</span></span>
<span>        <span class="co"># and let the carrying capacity</span></span>
<span>        <span class="co"># depend on the habitat quality</span></span>
<span>        <span class="fu"><a href="../reference/ricker_reproduction_model.html">ricker_reproduction_model</a></span><span class="op">(</span></span>
<span>            <span class="va">self</span><span class="op">$</span><span class="va">traits</span><span class="op">$</span><span class="va">abundance</span>,</span>
<span>            <span class="va">self</span><span class="op">$</span><span class="va">traits</span><span class="op">$</span><span class="va">reproduction_rate</span>,</span>
<span>            <span class="va">self</span><span class="op">$</span><span class="va">traits</span><span class="op">$</span><span class="va">carrying_capacity</span> <span class="op">*</span> <span class="va">self</span><span class="op">$</span><span class="va">sim</span><span class="op">$</span><span class="va">environment</span><span class="op">$</span><span class="va">current</span><span class="op">$</span><span class="va">habitat_quality</span></span>
<span>        <span class="op">)</span></span>
<span></span>
<span>        <span class="co"># print out the current mean abundance</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span></span>
<span>            <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"mean abundance: "</span>, <span class="fu"><a href="https://rdrr.io/pkg/terra/man/summarize-generics.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">self</span><span class="op">$</span><span class="va">traits</span><span class="op">$</span><span class="va">abundance</span><span class="op">)</span><span class="op">)</span></span>
<span>        <span class="op">)</span></span>
<span>    <span class="op">}</span>,</span>
<span>    execution_priority <span class="op">=</span> <span class="fl">1</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; adding process: reproduction</span></span>
<span><span class="co">#&gt; to species:</span></span>
<span><span class="co">#&gt; [1] "species_1"</span></span>
<span><span class="co">#&gt; </span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="executing-the-simulation">Executing the simulation<a class="anchor" aria-label="anchor" href="#executing-the-simulation"></a>
</h2>
<p>After the species, traits and processes are added to the simulation,
it can be executed via the <code>begin()</code> method.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim</span><span class="op">$</span><span class="fu">begin</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Starting simualtion.</span></span>
<span><span class="co">#&gt; passed initial sanity checks.</span></span>
<span><span class="co">#&gt; start of time step: 1</span></span>
<span><span class="co">#&gt; |- species_1 : reproduction</span></span>
<span><span class="co">#&gt; [1] "mean abundance: 84.1732579542268"</span></span>
<span><span class="co">#&gt; |---- 0.00061 secs</span></span>
<span><span class="co">#&gt; end of time step: 1</span></span>
<span><span class="co">#&gt; 0.06 secs remaining (estimate)</span></span>
<span><span class="co">#&gt; 10 % done</span></span>
<span><span class="co">#&gt; start of time step: 2</span></span>
<span><span class="co">#&gt; |- species_1 : reproduction</span></span>
<span><span class="co">#&gt; [1] "mean abundance: 127.598064388471"</span></span>
<span><span class="co">#&gt; |---- 0.00054 secs</span></span>
<span><span class="co">#&gt; end of time step: 2</span></span>
<span><span class="co">#&gt; 0.089 secs remaining (estimate)</span></span>
<span><span class="co">#&gt; 20 % done</span></span>
<span><span class="co">#&gt; start of time step: 3</span></span>
<span><span class="co">#&gt; |- species_1 : reproduction</span></span>
<span><span class="co">#&gt; [1] "mean abundance: 185.433176212344"</span></span>
<span><span class="co">#&gt; |---- 0.00047 secs</span></span>
<span><span class="co">#&gt; end of time step: 3</span></span>
<span><span class="co">#&gt; 0.037 secs remaining (estimate)</span></span>
<span><span class="co">#&gt; 30 % done</span></span>
<span><span class="co">#&gt; start of time step: 4</span></span>
<span><span class="co">#&gt; |- species_1 : reproduction</span></span>
<span><span class="co">#&gt; [1] "mean abundance: 254.974925085775"</span></span>
<span><span class="co">#&gt; |---- 0.00055 secs</span></span>
<span><span class="co">#&gt; end of time step: 4</span></span>
<span><span class="co">#&gt; 0.036 secs remaining (estimate)</span></span>
<span><span class="co">#&gt; 40 % done</span></span>
<span><span class="co">#&gt; start of time step: 5</span></span>
<span><span class="co">#&gt; |- species_1 : reproduction</span></span>
<span><span class="co">#&gt; [1] "mean abundance: 328.335965177599"</span></span>
<span><span class="co">#&gt; |---- 0.00046 secs</span></span>
<span><span class="co">#&gt; end of time step: 5</span></span>
<span><span class="co">#&gt; 0.027 secs remaining (estimate)</span></span>
<span><span class="co">#&gt; 50 % done</span></span>
<span><span class="co">#&gt; start of time step: 6</span></span>
<span><span class="co">#&gt; |- species_1 : reproduction</span></span>
<span><span class="co">#&gt; [1] "mean abundance: 394.79908318955"</span></span>
<span><span class="co">#&gt; |---- 0.00054 secs</span></span>
<span><span class="co">#&gt; end of time step: 6</span></span>
<span><span class="co">#&gt; 0.023 secs remaining (estimate)</span></span>
<span><span class="co">#&gt; 60 % done</span></span>
<span><span class="co">#&gt; start of time step: 7</span></span>
<span><span class="co">#&gt; |- species_1 : reproduction</span></span>
<span><span class="co">#&gt; [1] "mean abundance: 446.224976588256"</span></span>
<span><span class="co">#&gt; |---- 0.00052 secs</span></span>
<span><span class="co">#&gt; end of time step: 7</span></span>
<span><span class="co">#&gt; 0.016 secs remaining (estimate)</span></span>
<span><span class="co">#&gt; 70 % done</span></span>
<span><span class="co">#&gt; start of time step: 8</span></span>
<span><span class="co">#&gt; |- species_1 : reproduction</span></span>
<span><span class="co">#&gt; [1] "mean abundance: 480.705159122178"</span></span>
<span><span class="co">#&gt; |---- 0.00052 secs</span></span>
<span><span class="co">#&gt; end of time step: 8</span></span>
<span><span class="co">#&gt; 0.011 secs remaining (estimate)</span></span>
<span><span class="co">#&gt; 80 % done</span></span>
<span><span class="co">#&gt; start of time step: 9</span></span>
<span><span class="co">#&gt; |- species_1 : reproduction</span></span>
<span><span class="co">#&gt; [1] "mean abundance: 501.356439544315"</span></span>
<span><span class="co">#&gt; |---- 0.00048 secs</span></span>
<span><span class="co">#&gt; end of time step: 9</span></span>
<span><span class="co">#&gt; 0.0056 secs remaining (estimate)</span></span>
<span><span class="co">#&gt; 90 % done</span></span>
<span><span class="co">#&gt; start of time step: 10</span></span>
<span><span class="co">#&gt; |- species_1 : reproduction</span></span>
<span><span class="co">#&gt; [1] "mean abundance: 512.803082103058"</span></span>
<span><span class="co">#&gt; |---- 5e-04 secs</span></span>
<span><span class="co">#&gt; end of time step: 10</span></span>
<span><span class="co">#&gt; 0 secs remaining (estimate)</span></span>
<span><span class="co">#&gt; 100 % done</span></span>
<span><span class="co">#&gt; Simulation: 'example_simulation' finished</span></span>
<span><span class="co">#&gt; Exiting the Simulation</span></span>
<span><span class="co">#&gt; Runtime: 0.068 secs</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="plotting-the-results">Plotting the results<a class="anchor" aria-label="anchor" href="#plotting-the-results"></a>
</h2>
<p>To investigate the results, you can use the <code><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot()</a></code>
function.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># define a nice color palette</span></span>
<span><span class="va">plot_cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html" class="external-link">hcl.colors</a></span><span class="op">(</span><span class="fl">100</span>, <span class="st">"BluYl"</span>, rev <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span></span>
<span>    <span class="va">sim</span>,</span>
<span>    obj <span class="op">=</span> <span class="st">"species_1"</span>,</span>
<span>    name <span class="op">=</span> <span class="st">"abundance"</span>,</span>
<span>    main <span class="op">=</span> <span class="st">"Species 1: abundance"</span>,</span>
<span>    col <span class="op">=</span> <span class="va">plot_cols</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="A01_intro_files/figure-html/resA-1.png" alt="Figure 5: The resulting abundance distribution of species 1 after 10 simulation time steps." width="700"><p class="caption">
Figure 5: The resulting abundance distribution of species 1 after 10
simulation time steps.
</p>
</div>
</div>
<div class="section level2">
<h2 id="saving-the-simulation">Saving the simulation<a class="anchor" aria-label="anchor" href="#saving-the-simulation"></a>
</h2>
<p>To save results you can use the <code><a href="../reference/save_species.html">save_species()</a></code> function.
This will save the (possibly specified) traits of a species, either as a
raster (.tif) or as a text (.csv) file, whatever is more appropriate for
the data. Note that this function does <em>not</em> save the species
processes. One should keep a copy of the script that is used to run the
simulation to make it repeatable.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/save_species.html">save_species</a></span><span class="op">(</span></span>
<span>    <span class="va">sim</span><span class="op">$</span><span class="va">species_1</span>,</span>
<span>    traits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"name"</span>, <span class="st">"of"</span>, <span class="st">"one_or_more"</span>, <span class="st">"traits"</span><span class="op">)</span>,</span>
<span>    path <span class="op">=</span> <span class="st">"path/to/a/folder/"</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<ol style="list-style-type: decimal">
<li><p>Ricker, W.E. (1954) Stock and recruitment. Journal of the
Fisheries Research Board of Canada, 11, 559–623. <a href="doi:10.1139/f54-039" class="uri">doi:10.1139/f54-039</a></p></li>
<li><p>Cabral, J.S. and Schurr, F.M. (2010) Estimating demographic
models for the range dynamics of plant species. Global Ecology and
Biogeography, 19, 85–97. <a href="doi:10.1111/j.1466-8238.2009.00492.x" class="uri">doi:10.1111/j.1466-8238.2009.00492.x</a></p></li>
</ol>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Stefan Fallert, Lea Li, Juliano Sarmento Cabral, Bavarian Ministry of Science and Arts (bayklif), Deutsche Bundesstiftung Umwelt (DBU).</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
